<!DOCTYPE html> <html lang="cn"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> 基于XGBoost模型的幸福度预测——阿里天池学习赛 | Geek F. x </title> <meta name="author" content="Geek F. x"> <meta name="description" content=""> <meta name="keywords" content="academic-website, portfolio-website, geek, geekfx, geekjkfx, jkfx, blog, computer-science, deep-learning, AI"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon/favicon_blue/favicon.ico?88a93ea07c0a82656ab29388cee125af"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jkfx.github.io/blog/2020/%E5%9F%BA%E4%BA%8EXGBoost%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%B9%B8%E7%A6%8F%E5%BA%A6%E9%A2%84%E6%B5%8B-%E9%98%BF%E9%87%8C%E5%A4%A9%E6%B1%A0%E5%AD%A6%E4%B9%A0%E8%B5%9B/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Geek</span> F. x </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <style>img{width:100%}</style> <div class="post"> <header class="post-header"> <h1 class="post-title">基于XGBoost模型的幸福度预测——阿里天池学习赛</h1> <p class="post-meta"> Created in December 20, 2020 </p> <p class="post-tags"> <a href="/blog/2020"> <i class="fa-solid fa-calendar fa-sm"></i> 2020 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>本文根据阿里天池学习赛《快来一起挖掘幸福感！》撰写</p> </blockquote> <h2 id="加载数据">加载数据</h2> <p>加载的是完整版的数据 <code class="language-plaintext highlighter-rouge">happiness_train_complete.csv</code> 。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_style</span><span class="p">(</span><span class="sh">'</span><span class="s">whitegrid</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 将 id 列作为 DataFrame 的 index 并且指定 survey_time 为时间序列
</span><span class="n">data_origin</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/happiness_train_complete.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">gbk</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <h2 id="数据集基本信息的探索">数据集基本信息的探索</h2> <p>下面简单输出前5行查看。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>happiness</th> <th>survey_type</th> <th>province</th> <th>city</th> <th>county</th> <th>survey_time</th> <th>gender</th> <th>birth</th> <th>nationality</th> <th>religion</th> <th>...</th> <th>neighbor_familiarity</th> <th>public_service_1</th> <th>public_service_2</th> <th>public_service_3</th> <th>public_service_4</th> <th>public_service_5</th> <th>public_service_6</th> <th>public_service_7</th> <th>public_service_8</th> <th>public_service_9</th> </tr> <tr> <th>id</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </thead> <tbody> <tr> <th>1</th> <td>4</td> <td>1</td> <td>12</td> <td>32</td> <td>59</td> <td>2015-08-04 14:18:00</td> <td>1</td> <td>1959</td> <td>1</td> <td>1</td> <td>...</td> <td>4</td> <td>50</td> <td>60</td> <td>50</td> <td>50</td> <td>30.0</td> <td>30</td> <td>50</td> <td>50</td> <td>50</td> </tr> <tr> <th>2</th> <td>4</td> <td>2</td> <td>18</td> <td>52</td> <td>85</td> <td>2015-07-21 15:04:00</td> <td>1</td> <td>1992</td> <td>1</td> <td>1</td> <td>...</td> <td>3</td> <td>90</td> <td>70</td> <td>70</td> <td>80</td> <td>85.0</td> <td>70</td> <td>90</td> <td>60</td> <td>60</td> </tr> <tr> <th>3</th> <td>4</td> <td>2</td> <td>29</td> <td>83</td> <td>126</td> <td>2015-07-21 13:24:00</td> <td>2</td> <td>1967</td> <td>1</td> <td>0</td> <td>...</td> <td>4</td> <td>90</td> <td>80</td> <td>75</td> <td>79</td> <td>80.0</td> <td>90</td> <td>90</td> <td>90</td> <td>75</td> </tr> <tr> <th>4</th> <td>5</td> <td>2</td> <td>10</td> <td>28</td> <td>51</td> <td>2015-07-25 17:33:00</td> <td>2</td> <td>1943</td> <td>1</td> <td>1</td> <td>...</td> <td>3</td> <td>100</td> <td>90</td> <td>70</td> <td>80</td> <td>80.0</td> <td>90</td> <td>90</td> <td>80</td> <td>80</td> </tr> <tr> <th>5</th> <td>4</td> <td>1</td> <td>7</td> <td>18</td> <td>36</td> <td>2015-08-10 09:50:00</td> <td>2</td> <td>1994</td> <td>1</td> <td>1</td> <td>...</td> <td>2</td> <td>50</td> <td>50</td> <td>50</td> <td>50</td> <td>50.0</td> <td>50</td> <td>50</td> <td>50</td> <td>50</td> </tr> </tbody> </table> <p>5 rows × 139 columns</p> </div> <p>查看数据的详细信息，共8000条记录，139个特征。</p> <p>第二列为特证名、第三列为非空记录个数、第四列为特征的数据格式。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Int64Index: 8000 entries, 1 to 8000
Data columns (total 139 columns):
 #   Column                Non-Null Count  Dtype         
---  ------                --------------  -----         
 0   happiness             8000 non-null   int64         
 1   survey_type           8000 non-null   int64         
 2   province              8000 non-null   int64         
 3   city                  8000 non-null   int64         
 4   county                8000 non-null   int64         
 5   survey_time           8000 non-null   datetime64[ns]
 6   gender                8000 non-null   int64         
 7   birth                 8000 non-null   int64         
 8   nationality           8000 non-null   int64         
 9   religion              8000 non-null   int64         
 10  religion_freq         8000 non-null   int64         
 11  edu                   8000 non-null   int64         
 12  edu_other             3 non-null      object        
 13  edu_status            6880 non-null   float64       
 14  edu_yr                6028 non-null   float64       
 15  income                8000 non-null   int64         
 16  political             8000 non-null   int64         
 17  join_party            824 non-null    float64       
 18  floor_area            8000 non-null   float64       
 19  property_0            8000 non-null   int64         
 20  property_1            8000 non-null   int64         
 21  property_2            8000 non-null   int64         
 22  property_3            8000 non-null   int64         
 23  property_4            8000 non-null   int64         
 24  property_5            8000 non-null   int64         
 25  property_6            8000 non-null   int64         
 26  property_7            8000 non-null   int64         
 27  property_8            8000 non-null   int64         
 28  property_other        66 non-null     object        
 29  height_cm             8000 non-null   int64         
 30  weight_jin            8000 non-null   int64         
 31  health                8000 non-null   int64         
 32  health_problem        8000 non-null   int64         
 33  depression            8000 non-null   int64         
 34  hukou                 8000 non-null   int64         
 35  hukou_loc             7996 non-null   float64       
 36  media_1               8000 non-null   int64         
 37  media_2               8000 non-null   int64         
 38  media_3               8000 non-null   int64         
 39  media_4               8000 non-null   int64         
 40  media_5               8000 non-null   int64         
 41  media_6               8000 non-null   int64         
 42  leisure_1             8000 non-null   int64         
 43  leisure_2             8000 non-null   int64         
 44  leisure_3             8000 non-null   int64         
 45  leisure_4             8000 non-null   int64         
 46  leisure_5             8000 non-null   int64         
 47  leisure_6             8000 non-null   int64         
 48  leisure_7             8000 non-null   int64         
 49  leisure_8             8000 non-null   int64         
 50  leisure_9             8000 non-null   int64         
 51  leisure_10            8000 non-null   int64         
 52  leisure_11            8000 non-null   int64         
 53  leisure_12            8000 non-null   int64         
 54  socialize             8000 non-null   int64         
 55  relax                 8000 non-null   int64         
 56  learn                 8000 non-null   int64         
 57  social_neighbor       7204 non-null   float64       
 58  social_friend         7204 non-null   float64       
 59  socia_outing          8000 non-null   int64         
 60  equity                8000 non-null   int64         
 61  class                 8000 non-null   int64         
 62  class_10_before       8000 non-null   int64         
 63  class_10_after        8000 non-null   int64         
 64  class_14              8000 non-null   int64         
 65  work_exper            8000 non-null   int64         
 66  work_status           2951 non-null   float64       
 67  work_yr               2951 non-null   float64       
 68  work_type             2951 non-null   float64       
 69  work_manage           2951 non-null   float64       
 70  insur_1               8000 non-null   int64         
 71  insur_2               8000 non-null   int64         
 72  insur_3               8000 non-null   int64         
 73  insur_4               8000 non-null   int64         
 74  family_income         7999 non-null   float64       
 75  family_m              8000 non-null   int64         
 76  family_status         8000 non-null   int64         
 77  house                 8000 non-null   int64         
 78  car                   8000 non-null   int64         
 79  invest_0              8000 non-null   int64         
 80  invest_1              8000 non-null   int64         
 81  invest_2              8000 non-null   int64         
 82  invest_3              8000 non-null   int64         
 83  invest_4              8000 non-null   int64         
 84  invest_5              8000 non-null   int64         
 85  invest_6              8000 non-null   int64         
 86  invest_7              8000 non-null   int64         
 87  invest_8              8000 non-null   int64         
 88  invest_other          29 non-null     object        
 89  son                   8000 non-null   int64         
 90  daughter              8000 non-null   int64         
 91  minor_child           6934 non-null   float64       
 92  marital               8000 non-null   int64         
 93  marital_1st           7172 non-null   float64       
 94  s_birth               6282 non-null   float64       
 95  marital_now           6230 non-null   float64       
 96  s_edu                 6282 non-null   float64       
 97  s_political           6282 non-null   float64       
 98  s_hukou               6282 non-null   float64       
 99  s_income              6282 non-null   float64       
 100 s_work_exper          6282 non-null   float64       
 101 s_work_status         2565 non-null   float64       
 102 s_work_type           2565 non-null   float64       
 103 f_birth               8000 non-null   int64         
 104 f_edu                 8000 non-null   int64         
 105 f_political           8000 non-null   int64         
 106 f_work_14             8000 non-null   int64         
 107 m_birth               8000 non-null   int64         
 108 m_edu                 8000 non-null   int64         
 109 m_political           8000 non-null   int64         
 110 m_work_14             8000 non-null   int64         
 111 status_peer           8000 non-null   int64         
 112 status_3_before       8000 non-null   int64         
 113 view                  8000 non-null   int64         
 114 inc_ability           8000 non-null   int64         
 115 inc_exp               8000 non-null   float64       
 116 trust_1               8000 non-null   int64         
 117 trust_2               8000 non-null   int64         
 118 trust_3               8000 non-null   int64         
 119 trust_4               8000 non-null   int64         
 120 trust_5               8000 non-null   int64         
 121 trust_6               8000 non-null   int64         
 122 trust_7               8000 non-null   int64         
 123 trust_8               8000 non-null   int64         
 124 trust_9               8000 non-null   int64         
 125 trust_10              8000 non-null   int64         
 126 trust_11              8000 non-null   int64         
 127 trust_12              8000 non-null   int64         
 128 trust_13              8000 non-null   int64         
 129 neighbor_familiarity  8000 non-null   int64         
 130 public_service_1      8000 non-null   int64         
 131 public_service_2      8000 non-null   int64         
 132 public_service_3      8000 non-null   int64         
 133 public_service_4      8000 non-null   int64         
 134 public_service_5      8000 non-null   float64       
 135 public_service_6      8000 non-null   int64         
 136 public_service_7      8000 non-null   int64         
 137 public_service_8      8000 non-null   int64         
 138 public_service_9      8000 non-null   int64         
dtypes: datetime64[ns](1), float64(25), int64(110), object(3)
memory usage: 8.5+ MB
</code></pre></div></div> <p>查看数据总体统计量。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">describe</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>happiness</th> <th>survey_type</th> <th>province</th> <th>city</th> <th>county</th> <th>gender</th> <th>birth</th> <th>nationality</th> <th>religion</th> <th>religion_freq</th> <th>...</th> <th>neighbor_familiarity</th> <th>public_service_1</th> <th>public_service_2</th> <th>public_service_3</th> <th>public_service_4</th> <th>public_service_5</th> <th>public_service_6</th> <th>public_service_7</th> <th>public_service_8</th> <th>public_service_9</th> </tr> </thead> <tbody> <tr> <th>count</th> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.00000</td> <td>8000.000000</td> <td>8000.00000</td> <td>8000.000000</td> <td>8000.000000</td> <td>...</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.000000</td> <td>8000.00000</td> <td>8000.000000</td> <td>8000.000000</td> </tr> <tr> <th>mean</th> <td>3.850125</td> <td>1.405500</td> <td>15.155375</td> <td>42.564750</td> <td>70.619000</td> <td>1.53000</td> <td>1964.707625</td> <td>1.37350</td> <td>0.772250</td> <td>1.427250</td> <td>...</td> <td>3.722250</td> <td>70.809500</td> <td>68.170000</td> <td>62.737625</td> <td>66.320125</td> <td>62.794187</td> <td>67.064000</td> <td>66.09625</td> <td>65.626750</td> <td>67.153750</td> </tr> <tr> <th>std</th> <td>0.938228</td> <td>0.491019</td> <td>8.917100</td> <td>27.187404</td> <td>38.747503</td> <td>0.49913</td> <td>16.842865</td> <td>1.52882</td> <td>1.071459</td> <td>1.408441</td> <td>...</td> <td>1.143358</td> <td>21.184742</td> <td>20.549943</td> <td>24.771319</td> <td>22.049437</td> <td>23.463162</td> <td>21.586817</td> <td>23.08568</td> <td>23.827493</td> <td>22.502203</td> </tr> <tr> <th>min</th> <td>-8.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.00000</td> <td>1921.000000</td> <td>-8.00000</td> <td>-8.000000</td> <td>-8.000000</td> <td>...</td> <td>-8.000000</td> <td>-3.000000</td> <td>-3.000000</td> <td>-3.000000</td> <td>-3.000000</td> <td>-3.000000</td> <td>-3.000000</td> <td>-3.00000</td> <td>-3.000000</td> <td>-3.000000</td> </tr> <tr> <th>25%</th> <td>4.000000</td> <td>1.000000</td> <td>7.000000</td> <td>18.000000</td> <td>37.000000</td> <td>1.00000</td> <td>1952.000000</td> <td>1.00000</td> <td>1.000000</td> <td>1.000000</td> <td>...</td> <td>3.000000</td> <td>60.000000</td> <td>60.000000</td> <td>50.000000</td> <td>60.000000</td> <td>55.000000</td> <td>60.000000</td> <td>60.00000</td> <td>60.000000</td> <td>60.000000</td> </tr> <tr> <th>50%</th> <td>4.000000</td> <td>1.000000</td> <td>15.000000</td> <td>42.000000</td> <td>73.000000</td> <td>2.00000</td> <td>1965.000000</td> <td>1.00000</td> <td>1.000000</td> <td>1.000000</td> <td>...</td> <td>4.000000</td> <td>79.000000</td> <td>70.000000</td> <td>70.000000</td> <td>70.000000</td> <td>70.000000</td> <td>70.000000</td> <td>70.00000</td> <td>70.000000</td> <td>70.000000</td> </tr> <tr> <th>75%</th> <td>4.000000</td> <td>2.000000</td> <td>22.000000</td> <td>65.000000</td> <td>104.000000</td> <td>2.00000</td> <td>1977.000000</td> <td>1.00000</td> <td>1.000000</td> <td>1.000000</td> <td>...</td> <td>5.000000</td> <td>80.000000</td> <td>80.000000</td> <td>80.000000</td> <td>80.000000</td> <td>80.000000</td> <td>80.000000</td> <td>80.00000</td> <td>80.000000</td> <td>80.000000</td> </tr> <tr> <th>max</th> <td>5.000000</td> <td>2.000000</td> <td>31.000000</td> <td>89.000000</td> <td>134.000000</td> <td>2.00000</td> <td>1997.000000</td> <td>8.00000</td> <td>1.000000</td> <td>9.000000</td> <td>...</td> <td>5.000000</td> <td>100.000000</td> <td>100.000000</td> <td>100.000000</td> <td>100.000000</td> <td>100.000000</td> <td>100.000000</td> <td>100.00000</td> <td>100.000000</td> <td>100.000000</td> </tr> </tbody> </table> <p>8 rows × 135 columns</p> </div> <h2 id="数据预处理">数据预处理</h2> <h3 id="缺失值处理">缺失值处理</h3> <p>查看子特征的缺失情况，其中</p> <ul> <li> <code class="language-plaintext highlighter-rouge">required_list</code> 表示特征中的必填项</li> <li> <code class="language-plaintext highlighter-rouge">continuous_list</code> 表示特征属性为连续型变量</li> <li> <code class="language-plaintext highlighter-rouge">categorical_list</code> 表示分类型变量</li> </ul> <p>其余特征均为等级（ordinal）型的分类变量。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">required_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">survey_type</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">county</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">gender</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">birth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">nationality</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">religion</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">religion_freq</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">edu</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">income</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">political</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">floor_area</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">height_cm</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">weight_jin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">health</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">health_problem</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">depression</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">hukou</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">socialize</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">relax</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">learn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">equity</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">class</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_exper</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_status</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_yr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_type</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">work_manage</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_income</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_m</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_status</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">house</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">car</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">status_peer</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">status_3_before</span><span class="sh">'</span><span class="p">,</span> 
                 <span class="sh">'</span><span class="s">view</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">inc_ability</span><span class="sh">'</span><span class="p">]</span>
<span class="n">continuous_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">birth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">edu_yr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">income</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">floor_area</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">height_cm</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">weight_jin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_yr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_income</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_m</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">house</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">son</span><span class="sh">'</span><span class="p">,</span> 
                   <span class="sh">'</span><span class="s">daughter</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">minor_child</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">marital_1st</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">s_birth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">marital_now</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">s_income</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">f_birth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">m_birth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">inc_exp</span><span class="sh">'</span><span class="p">,</span>
                  <span class="sh">'</span><span class="s">public_service_1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">public_service_2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">public_service_3</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">public_service_4</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">public_service_5</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">public_service_6</span><span class="sh">'</span><span class="p">,</span>
                  <span class="sh">'</span><span class="s">public_service_7</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">public_service_8</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">public_service_9</span><span class="sh">'</span><span class="p">]</span>
<span class="n">categorical_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">survey_type</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">gender</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">nationality</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> <h4 id="必填项的缺失值分析">必填项的缺失值分析</h4> <p>查看必填项中缺失值的情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">()[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">().</span><span class="n">T</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>work_status</th> <th>work_yr</th> <th>work_type</th> <th>work_manage</th> <th>family_income</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>5049</td> <td>5049</td> <td>5049</td> <td>5049</td> <td>1</td> </tr> </tbody> </table> </div> <p>其中</p> <ul> <li> <code class="language-plaintext highlighter-rouge">work_status</code> 表示 目前工作的状况</li> <li> <code class="language-plaintext highlighter-rouge">work_yr</code> 表示 一共工作了多少年</li> <li> <code class="language-plaintext highlighter-rouge">work_type</code> 表示 目前工作的性质</li> <li> <code class="language-plaintext highlighter-rouge">work_manage</code> 表示 目前工作的管理活动情况</li> <li> <code class="language-plaintext highlighter-rouge">family_income</code> 表示 去年全年家庭总收入</li> </ul> <p>首先分析 <code class="language-plaintext highlighter-rouge">work_</code> 开头的四项特征的缺失情况，它们的缺失计数一样，可能说明调查问卷的填写方式，可能被跳过了。</p> <p>首先检查调查问卷，找到对应的问卷问题，发现在 <code class="language-plaintext highlighter-rouge">work_exper</code> 特征中，即 工作经历及状况，根据不同的工作经历，将上面四个问题跳过。</p> <p>查看 <code class="language-plaintext highlighter-rouge">work_exper</code> 对应的问卷。</p> <p><img src="https://tva1.sinaimg.cn/large/006VTcCxly1glpgvo45lvj30yy096q4h.jpg" alt="图片"></p> <p>可以发现 <code class="language-plaintext highlighter-rouge">work_exper</code> 除了 <code class="language-plaintext highlighter-rouge">1</code> 分类，其它问题均被跳问；所以将上面四列的缺失记录的 <code class="language-plaintext highlighter-rouge">work_exper</code> 输出，查看是否都为非 <code class="language-plaintext highlighter-rouge">1</code> 类的记录。</p> <p>通过下面的输出可以看到，在上面四项特征为缺失值的情况下，其记录对应的 <code class="language-plaintext highlighter-rouge">work_exper</code> 的取值大部分不为 <code class="language-plaintext highlighter-rouge">1</code> 。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_exper</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">().</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_exper</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5    1968
3    1242
4    1065
2     387
6     380
1       7
Name: work_exper, dtype: int64
</code></pre></div></div> <p><img src="https://tva4.sinaimg.cn/large/006VTcCxly1gluiojypjsj30av06v0so.jpg" alt="output_15_1"></p> <p>进一步查看取值为 <code class="language-plaintext highlighter-rouge">1</code> 的记录。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])[(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">work_exper</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>happiness</th> <th>survey_type</th> <th>province</th> <th>city</th> <th>county</th> <th>survey_time</th> <th>gender</th> <th>birth</th> <th>nationality</th> <th>religion</th> <th>...</th> <th>neighbor_familiarity</th> <th>public_service_1</th> <th>public_service_2</th> <th>public_service_3</th> <th>public_service_4</th> <th>public_service_5</th> <th>public_service_6</th> <th>public_service_7</th> <th>public_service_8</th> <th>public_service_9</th> </tr> <tr> <th>id</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </thead> <tbody> <tr> <th>692</th> <td>4</td> <td>2</td> <td>21</td> <td>64</td> <td>101</td> <td>2015-07-20 11:12:00</td> <td>2</td> <td>1975</td> <td>1</td> <td>1</td> <td>...</td> <td>5</td> <td>80</td> <td>70</td> <td>80</td> <td>80</td> <td>80.0</td> <td>80</td> <td>80</td> <td>80</td> <td>80</td> </tr> <tr> <th>841</th> <td>4</td> <td>2</td> <td>31</td> <td>88</td> <td>133</td> <td>2015-08-17 13:49:00</td> <td>2</td> <td>1971</td> <td>1</td> <td>0</td> <td>...</td> <td>4</td> <td>50</td> <td>30</td> <td>-2</td> <td>-2</td> <td>-2.0</td> <td>50</td> <td>50</td> <td>50</td> <td>70</td> </tr> <tr> <th>1411</th> <td>4</td> <td>2</td> <td>2</td> <td>2</td> <td>9</td> <td>2015-07-23 09:25:00</td> <td>1</td> <td>1967</td> <td>8</td> <td>1</td> <td>...</td> <td>4</td> <td>90</td> <td>85</td> <td>80</td> <td>90</td> <td>90.0</td> <td>92</td> <td>93</td> <td>94</td> <td>90</td> </tr> <tr> <th>3117</th> <td>4</td> <td>1</td> <td>4</td> <td>7</td> <td>18</td> <td>2015-10-03 16:02:00</td> <td>1</td> <td>1980</td> <td>1</td> <td>1</td> <td>...</td> <td>2</td> <td>30</td> <td>35</td> <td>30</td> <td>40</td> <td>60.0</td> <td>40</td> <td>30</td> <td>70</td> <td>70</td> </tr> <tr> <th>4783</th> <td>5</td> <td>2</td> <td>22</td> <td>65</td> <td>103</td> <td>2015-07-08 18:45:00</td> <td>1</td> <td>1955</td> <td>1</td> <td>1</td> <td>...</td> <td>5</td> <td>90</td> <td>90</td> <td>90</td> <td>90</td> <td>80.0</td> <td>90</td> <td>80</td> <td>90</td> <td>90</td> </tr> <tr> <th>5589</th> <td>5</td> <td>2</td> <td>16</td> <td>46</td> <td>78</td> <td>2015-07-29 11:34:00</td> <td>2</td> <td>1964</td> <td>1</td> <td>1</td> <td>...</td> <td>3</td> <td>89</td> <td>63</td> <td>67</td> <td>75</td> <td>74.0</td> <td>67</td> <td>65</td> <td>78</td> <td>79</td> </tr> <tr> <th>7368</th> <td>4</td> <td>2</td> <td>21</td> <td>64</td> <td>101</td> <td>2015-07-19 08:32:00</td> <td>2</td> <td>1963</td> <td>1</td> <td>1</td> <td>...</td> <td>5</td> <td>70</td> <td>70</td> <td>70</td> <td>60</td> <td>70.0</td> <td>70</td> <td>60</td> <td>60</td> <td>60</td> </tr> </tbody> </table> <p>7 rows × 139 columns</p> </div> <p>可以发现 <code class="language-plaintext highlighter-rouge">work_exper</code> 为 <code class="language-plaintext highlighter-rouge">1</code> 的记录存在7条，故将此删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">((</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])[(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">required_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">work_exper</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>因为 <code class="language-plaintext highlighter-rouge">family_income</code> 缺失个数只有1条，不影响数据规模，所以直接将其删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">family_income</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">family_income</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <h4 id="连续型特征缺失值分析">连续型特征缺失值分析</h4> <p>查看连续型特征的却失情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">continuous_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">()[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">continuous_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">().</span><span class="n">T</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>edu_yr</th> <th>work_yr</th> <th>minor_child</th> <th>marital_1st</th> <th>s_birth</th> <th>marital_now</th> <th>s_income</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>1970</td> <td>5041</td> <td>1066</td> <td>828</td> <td>1718</td> <td>1770</td> <td>1718</td> </tr> </tbody> </table> </div> <p>其中</p> <ul> <li> <code class="language-plaintext highlighter-rouge">edu_yr</code> 表示 已经完成的最高学历是哪一年获得的</li> <li> <code class="language-plaintext highlighter-rouge">work_yr</code> 表示 第一份非农工作到目前的工作一共工作了多少年</li> <li> <code class="language-plaintext highlighter-rouge">minor_child</code> 表示 有几个18周岁以下未成年子女</li> <li> <code class="language-plaintext highlighter-rouge">marital_1st</code> 表示 第一次结婚的时间</li> <li> <code class="language-plaintext highlighter-rouge">s_birth</code> 表示 目前的配偶或同居伴侣是哪一年出生的</li> <li> <code class="language-plaintext highlighter-rouge">martital_now</code> 表示 与目前的配偶是哪一年结婚的</li> <li> <code class="language-plaintext highlighter-rouge">s_income</code> 表示 配偶或同居伴侣去年全年的总收入</li> </ul> <p>对于 <code class="language-plaintext highlighter-rouge">edu_yr</code> 即 已经完成的最高学历是哪一年获得的，查看缺失记录的 <code class="language-plaintext highlighter-rouge">edu_status</code> 取值分布情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_yr</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">edu_status</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_yr</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">edu_status</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2.0    746
3.0    103
4.0      1
1.0      1
Name: edu_status, dtype: int64
</code></pre></div></div> <p><img src="https://tvax4.sinaimg.cn/large/006VTcCxly1gluiot98ydj30ap06vdfq.jpg" alt="output_26_1"></p> <p>查看 <code class="language-plaintext highlighter-rouge">edu_yr</code> 缺失的记录的 <code class="language-plaintext highlighter-rouge">edu_status</code> 特征后，只有选项 <code class="language-plaintext highlighter-rouge">4</code> 即 毕业的记录才应该填写 <code class="language-plaintext highlighter-rouge">edu_yr</code> 的毕业年份，所以应该删除记录。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_status</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_yr</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(7991, 139)
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">minor_child</code> 特征，可以检查这个特征缺失的记录另外两项特征 <code class="language-plaintext highlighter-rouge">son</code> 和 <code class="language-plaintext highlighter-rouge">daughter</code> 分别表示儿子、女儿的数量，如果为0，则将 <code class="language-plaintext highlighter-rouge">minor_child</code> 也填充为0。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">minor_child</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())].</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">'</span><span class="s">son</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">minor_child</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())].</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">'</span><span class="s">daughter</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">())</span>
<span class="n">data_origin</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">minor_child</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())].</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">'</span><span class="s">son</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">daughter</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
0
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>son</th> <th>daughter</th> </tr> <tr> <th>id</th> <th></th> <th></th> </tr> </thead> <tbody> <tr> <th>2</th> <td>0</td> <td>0</td> </tr> <tr> <th>5</th> <td>0</td> <td>0</td> </tr> <tr> <th>9</th> <td>0</td> <td>0</td> </tr> <tr> <th>29</th> <td>0</td> <td>0</td> </tr> <tr> <th>31</th> <td>0</td> <td>0</td> </tr> <tr> <th>...</th> <td>...</td> <td>...</td> </tr> <tr> <th>7967</th> <td>0</td> <td>0</td> </tr> <tr> <th>7972</th> <td>0</td> <td>0</td> </tr> <tr> <th>7991</th> <td>0</td> <td>0</td> </tr> <tr> <th>7999</th> <td>0</td> <td>0</td> </tr> <tr> <th>8000</th> <td>0</td> <td>0</td> </tr> </tbody> </table> <p>1066 rows × 2 columns</p> </div> <p>可以看对 <code class="language-plaintext highlighter-rouge">minor_child</code> 缺失的记录，其儿子和女儿的个数也为0，所以将 <code class="language-plaintext highlighter-rouge">minor_child</code> 缺失值填充为0。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">minor_child</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">marital_1st</code> 的记录的缺失情况，可以查看对应的记录的 <code class="language-plaintext highlighter-rouge">marital</code> 的取值是否为 <code class="language-plaintext highlighter-rouge">1</code> 表示 未婚。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_1st</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">data_origin</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_1st</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">data_origin</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_1st</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_1st</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">())][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>True





1    828
Name: marital, dtype: int64
</code></pre></div></div> <p><img src="https://tva1.sinaimg.cn/large/006VTcCxly1gluiozohf6j30ap06vt8m.jpg" alt="output_35_2"></p> <p>可以看到输出结果表明对于 <code class="language-plaintext highlighter-rouge">marital_1st</code> 缺失的记录都是未婚人士，所以缺失值正常。</p> <p>下面查看 <code class="language-plaintext highlighter-rouge">s_birth</code> 即 目前的配偶或同居伴侣是哪一年出生的的缺失情况，首先查看缺失的记录的 <code class="language-plaintext highlighter-rouge">marital</code> 状态，查看是否满足无配偶或同居伴侣的情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_birth</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_birth</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    828
7    718
6    171
2      1
Name: marital, dtype: int64
</code></pre></div></div> <p><img src="https://tvax4.sinaimg.cn/large/006VTcCxly1gluip4t3mtj30ap06vwee.jpg" alt="output_37_1"></p> <p>根据输出可以看到，<code class="language-plaintext highlighter-rouge">marital</code> 取值为 <code class="language-plaintext highlighter-rouge">1</code> 、<code class="language-plaintext highlighter-rouge">6</code>、<code class="language-plaintext highlighter-rouge">7</code> 分别表示 未婚、离婚和丧偶，所以 <code class="language-plaintext highlighter-rouge">s_birth</code> 缺失属于正常；而且取值为 <code class="language-plaintext highlighter-rouge">2</code> 表示同居的缺失记录只有一条，所以直接将其删除即可。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_birth</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">][</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_birth</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">marital_now</code> 即 与目前的配偶是哪一年结婚的，首先输出 <code class="language-plaintext highlighter-rouge">marital</code> 查看婚姻的状态，是否满足没结婚的条件。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_now</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_now</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    828
7    718
6    171
2     51
3      1
Name: marital, dtype: int64
</code></pre></div></div> <p><img src="https://tva4.sinaimg.cn/large/006VTcCxly1gluip988tnj30ap06vwee.jpg" alt="output_41_1"></p> <p>根据输出可以得到 <code class="language-plaintext highlighter-rouge">1</code> 和 <code class="language-plaintext highlighter-rouge">2</code> 表示没有结婚的情况，所以缺失属于正常；</p> <p>对于 <code class="language-plaintext highlighter-rouge">3</code>、<code class="language-plaintext highlighter-rouge">6</code>、<code class="language-plaintext highlighter-rouge">7</code> 分别表示 初婚有配偶、离婚、丧偶；只有 <code class="language-plaintext highlighter-rouge">3</code> 属于目前有配偶并结婚的情况，所以应该删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_now</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()].</span><span class="n">loc</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">marital_now</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(7989, 139)
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">s_income</code> 即 配偶或同居伴侣去年全年的总收入的缺失情况，可以检查对于 <code class="language-plaintext highlighter-rouge">marital</code> 查看其是否满足无配偶或伴侣的条件。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_income</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_income</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    828
7    718
6    171
Name: marital, dtype: int64
</code></pre></div></div> <p><img src="https://tvax4.sinaimg.cn/large/006VTcCxly1gluipdoqzpj30ap06vwee.jpg" alt="output_46_1"></p> <p>可以看到对于 <code class="language-plaintext highlighter-rouge">s_income</code> 的缺失值，其记录对应的婚姻状态都为未婚、离婚或丧偶，所以 <code class="language-plaintext highlighter-rouge">s_income</code> 缺失是正常的。</p> <h4 id="分类变量缺失值分析">分类变量缺失值分析</h4> <p>查看分类型（categorical）变量的缺失情况，全部为0，则没有缺失值。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">categorical_list</span><span class="p">].</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">().</span><span class="nf">to_frame</span><span class="p">().</span><span class="n">T</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>survey_type</th> <th>province</th> <th>gender</th> <th>nationality</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> </div> <h4 id="所有特征缺失值分析">所有特征缺失值分析</h4> <p>查看所有特征的缺失情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">()[</span><span class="n">data_origin</span><span class="p">.</span><span class="nf">isna</span><span class="p">().</span><span class="nf">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">().</span><span class="n">T</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>edu_other</th> <th>edu_status</th> <th>edu_yr</th> <th>join_party</th> <th>property_other</th> <th>hukou_loc</th> <th>social_neighbor</th> <th>social_friend</th> <th>work_status</th> <th>work_yr</th> <th>...</th> <th>marital_1st</th> <th>s_birth</th> <th>marital_now</th> <th>s_edu</th> <th>s_political</th> <th>s_hukou</th> <th>s_income</th> <th>s_work_exper</th> <th>s_work_status</th> <th>s_work_type</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>7986</td> <td>1119</td> <td>1969</td> <td>7167</td> <td>7923</td> <td>4</td> <td>795</td> <td>795</td> <td>5038</td> <td>5038</td> <td>...</td> <td>828</td> <td>1717</td> <td>1768</td> <td>1717</td> <td>1717</td> <td>1717</td> <td>1717</td> <td>1717</td> <td>5427</td> <td>5427</td> </tr> </tbody> </table> <p>1 rows × 23 columns</p> </div> <p>首先对于 <code class="language-plaintext highlighter-rouge">edu_other</code> 特征，只有在 <code class="language-plaintext highlighter-rouge">edu</code> 填写了 <code class="language-plaintext highlighter-rouge">14</code> 的情况下才填写，首先检查 <code class="language-plaintext highlighter-rouge">edu_other</code> 缺失的记录的 <code class="language-plaintext highlighter-rouge">edu</code> 是否为 <code class="language-plaintext highlighter-rouge">14</code> 若为 <code class="language-plaintext highlighter-rouge">14</code> 则说明 <code class="language-plaintext highlighter-rouge">edu_other</code> 不应该为缺失，应该将其删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">edu</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">14</span><span class="p">]</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>happiness</th> <th>survey_type</th> <th>province</th> <th>city</th> <th>county</th> <th>survey_time</th> <th>gender</th> <th>birth</th> <th>nationality</th> <th>religion</th> <th>...</th> <th>neighbor_familiarity</th> <th>public_service_1</th> <th>public_service_2</th> <th>public_service_3</th> <th>public_service_4</th> <th>public_service_5</th> <th>public_service_6</th> <th>public_service_7</th> <th>public_service_8</th> <th>public_service_9</th> </tr> <tr> <th>id</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </thead> <tbody> <tr> <th>1242</th> <td>4</td> <td>2</td> <td>3</td> <td>6</td> <td>13</td> <td>2015-09-24 17:58:00</td> <td>1</td> <td>1971</td> <td>1</td> <td>1</td> <td>...</td> <td>5</td> <td>100</td> <td>90</td> <td>60</td> <td>80</td> <td>70.0</td> <td>80</td> <td>70</td> <td>60</td> <td>50</td> </tr> <tr> <th>3651</th> <td>3</td> <td>2</td> <td>3</td> <td>6</td> <td>13</td> <td>2015-09-24 20:25:00</td> <td>1</td> <td>1953</td> <td>1</td> <td>1</td> <td>...</td> <td>5</td> <td>100</td> <td>100</td> <td>60</td> <td>50</td> <td>70.0</td> <td>50</td> <td>30</td> <td>70</td> <td>40</td> </tr> <tr> <th>5330</th> <td>2</td> <td>2</td> <td>3</td> <td>6</td> <td>13</td> <td>2015-09-25 07:57:00</td> <td>1</td> <td>1953</td> <td>1</td> <td>1</td> <td>...</td> <td>5</td> <td>100</td> <td>100</td> <td>100</td> <td>100</td> <td>100.0</td> <td>100</td> <td>30</td> <td>100</td> <td>50</td> </tr> </tbody> </table> <p>3 rows × 139 columns</p> </div> <p>可以看到 <code class="language-plaintext highlighter-rouge">edu</code> 为 <code class="language-plaintext highlighter-rouge">14</code> 的记录中，有3条记录 <code class="language-plaintext highlighter-rouge">edu_other</code> 也为缺失；所以将3条记录删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">edu</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">14</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">edu_status</code> 的缺失记录，可以先检查记录对应的 <code class="language-plaintext highlighter-rouge">edu</code> 是取的何值。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">edu</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">edu</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    1052
2      65
3       2
Name: edu, dtype: int64
</code></pre></div></div> <p><img src="https://tvax1.sinaimg.cn/large/006VTcCxly1gluipl0cmij30av06v0sm.jpg" alt="output_57_1"></p> <p>可以看到对于 <code class="language-plaintext highlighter-rouge">edu_status</code> 缺失的记录，其对应的 <code class="language-plaintext highlighter-rouge">edu</code> 教育程度为别为没有受过任何教育、私塾、扫盲班和小学；对于取值为 <code class="language-plaintext highlighter-rouge">1</code> 和 <code class="language-plaintext highlighter-rouge">2</code> 的情况，属于跳问选项，对应的 <code class="language-plaintext highlighter-rouge">edu_status</code> 属于缺失是正常的；所以将 <code class="language-plaintext highlighter-rouge">edu</code> 取值为 <code class="language-plaintext highlighter-rouge">3</code> 的记录删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">edu</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">join_party</code> 即 目前政治面貌是党员的入党时间，只有政治面貌不是党员的缺失值才算正确，查看分布情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">join_party</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">political</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">join_party</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">political</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 1    6703
 2     402
-8      41
 3      11
 4       5
Name: political, dtype: int64
</code></pre></div></div> <p><img src="https://tvax1.sinaimg.cn/large/006VTcCxly1gluipqiffij30av06yjra.jpg" alt="output_61_1"></p> <p>根据直方图看到，有5条记录的 <code class="language-plaintext highlighter-rouge">partical</code> 的取值是 <code class="language-plaintext highlighter-rouge">4</code> 而入党时间没有填写，所以将这5条记录删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">join_party</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">join_party</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">political</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">hukou_loc</code> 即 目前的户口登记地，查看缺失记录的 <code class="language-plaintext highlighter-rouge">hukou</code> 登记情况，发现取值都为 <code class="language-plaintext highlighter-rouge">7</code> 即 没有户口，所以缺失属于正常。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">hukou_loc</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">hukou</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>hukou</th> </tr> <tr> <th>id</th> <th></th> </tr> </thead> <tbody> <tr> <th>589</th> <td>7</td> </tr> <tr> <th>3657</th> <td>7</td> </tr> <tr> <th>3799</th> <td>7</td> </tr> <tr> <th>7811</th> <td>7</td> </tr> </tbody> </table> </div> <p>对于 <code class="language-plaintext highlighter-rouge">social_neighbor</code> 和 <code class="language-plaintext highlighter-rouge">social_friend</code> 即与与其他朋友进行社交娱乐活动的频繁程度和有多少个晚上是因为出去度假或者探访亲友而没有在家过夜，首先查看缺失记录的 <code class="language-plaintext highlighter-rouge">socialize</code> 的分布情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">social_neighbor</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">socialize</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">social_neighbor</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">socialize</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    793
Name: socialize, dtype: int64
</code></pre></div></div> <p><img src="https://tva2.sinaimg.cn/large/006VTcCxly1gluipvuibkj30ap06vt8m.jpg" alt="output_67_1"></p> <p>可以发现所有的 <code class="language-plaintext highlighter-rouge">social_neighbor</code> 和 <code class="language-plaintext highlighter-rouge">social_friend</code> 缺失记录的 <code class="language-plaintext highlighter-rouge">socialize</code> 即 是否经常在空闲时间做社交的事情全部均为 <code class="language-plaintext highlighter-rouge">1</code> 即 从不社交，所以两个特征的缺失值可以使用 <code class="language-plaintext highlighter-rouge">1</code> 填充。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">social_neighbor</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">social_friend</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>对于 <code class="language-plaintext highlighter-rouge">s_edu</code> 到 <code class="language-plaintext highlighter-rouge">s_work_exper</code> 的特征，缺失值的记录数都一样，所以存在可能这几项特征的缺失记录都来自同一批问卷对象。</p> <p>首先查看 <code class="language-plaintext highlighter-rouge">s_edu</code> 的缺失记录的 <code class="language-plaintext highlighter-rouge">marital</code> 的分布情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_edu</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_edu</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    827
7    717
6    171
Name: marital, dtype: int64
</code></pre></div></div> <p><img src="https://tva2.sinaimg.cn/large/006VTcCxly1gluiq1nsc8j30ap06vwee.jpg" alt="output_71_1"></p> <p>可以发现 <code class="language-plaintext highlighter-rouge">s_edu</code> 缺失的记录的婚姻情况全部均为未婚、离婚或丧偶，均属于没有配偶或同居伴侣的情况，所以属于正常的缺失。</p> <p>对于 <code class="language-plaintext highlighter-rouge">s_political</code> 到 <code class="language-plaintext highlighter-rouge">s_work_exper</code> 全部均属于上述情况。</p> <p>对于 <code class="language-plaintext highlighter-rouge">s_work_status</code> 即 配偶或同居伴侣目前的工作状况，首先查看调查问卷。</p> <p><img src="https://tvax3.sinaimg.cn/large/006VTcCxly1glq05rnq47j30xy09kq4n.jpg" alt="图片"></p> <p>可以得知只有 <code class="language-plaintext highlighter-rouge">s_work_exper</code> 填写了 <code class="language-plaintext highlighter-rouge">1</code> 的情况下才应该填写 <code class="language-plaintext highlighter-rouge">s_work_status</code> 和 <code class="language-plaintext highlighter-rouge">s_work_type</code> 其它选项均需要跳过，所以属于正常缺失值。</p> <p>下面查看 <code class="language-plaintext highlighter-rouge">s_work_status</code> 缺失记录的 <code class="language-plaintext highlighter-rouge">s_work_exper</code> 的分布情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_work_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">s_work_exper</span><span class="sh">'</span><span class="p">].</span><span class="n">plot</span><span class="p">.</span><span class="nf">hist</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_work_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">s_work_exper</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5.0    1424
3.0    1017
4.0     823
6.0     221
2.0     217
1.0       1
Name: s_work_exper, dtype: int64
</code></pre></div></div> <p><img src="https://tvax2.sinaimg.cn/large/006VTcCxly1gluiq62r3vj30av06vgli.jpg" alt="output_73_1"></p> <p>查看得知 <code class="language-plaintext highlighter-rouge">s_work_exper</code> 选 <code class="language-plaintext highlighter-rouge">1</code> 的记录只有1条，直接删除即可。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_work_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">s_work_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">()][</span><span class="sh">'</span><span class="s">s_work_exper</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>在调查问卷中，每个选项通用含义，其 <code class="language-plaintext highlighter-rouge">-1</code> 表示不适用；<code class="language-plaintext highlighter-rouge">-2</code> 表示不知道；<code class="language-plaintext highlighter-rouge">-3</code> 表示拒绝回答；<code class="language-plaintext highlighter-rouge">-8</code> 表示无法回答。</p> <p>在这里将所有的特征的负数使用每一个特征的中位数进行填充。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(7978, 139)
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">no_ne_rows_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">invest_other</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[(</span><span class="n">data_origin</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">invest_other</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">].</span><span class="n">index</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">data_origin</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">pd</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">types</span><span class="p">.</span><span class="nf">is_numeric_dtype</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
        <span class="n">data_origin</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_origin</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">no_ne_rows_index</span><span class="p">,</span> <span class="p">:][</span><span class="n">column</span><span class="p">].</span><span class="nf">unique</span><span class="p">()).</span><span class="nf">median</span><span class="p">()</span> <span class="nf">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></div> <p>将所有的负数填充完成后，再将 <code class="language-plaintext highlighter-rouge">NaN</code> 数值全部使用统一的一个值 <code class="language-plaintext highlighter-rouge">-1</code> 填充。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>至此，所有特征的缺失值已经全部处理完毕。</p> <h3 id="文本数据处理">文本数据处理</h3> <p>在所有的特征中，有3个特征分别是 <code class="language-plaintext highlighter-rouge">edu_other</code>、<code class="language-plaintext highlighter-rouge">property_other</code>、<code class="language-plaintext highlighter-rouge">invest_other</code> 是字符串数据，需要将其转换成序号编码（Ordinal Encoding）。</p> <p>首先查看 <code class="language-plaintext highlighter-rouge">edu_other</code> 的填写情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>edu_other</th> </tr> <tr> <th>id</th> <th></th> </tr> </thead> <tbody> <tr> <th>1170</th> <td>夜校</td> </tr> <tr> <th>2513</th> <td>夜校</td> </tr> <tr> <th>4926</th> <td>夜校</td> </tr> </tbody> </table> </div> <p>可以看到 <code class="language-plaintext highlighter-rouge">edu_other</code> 的填写情况全都是夜校，将字符串转换成序号编码。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">edu_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">).</span><span class="n">values</span><span class="p">.</span><span class="n">codes</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div> <p>查看 <code class="language-plaintext highlighter-rouge">property_other</code> 即 房子产权归属谁，首先检查调查问卷的填写情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_frame</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>property_other</th> </tr> <tr> <th>id</th> <th></th> </tr> </thead> <tbody> <tr> <th>76</th> <td>无产权</td> </tr> <tr> <th>92</th> <td>已购买，但未过户</td> </tr> <tr> <th>99</th> <td>家庭共同所有</td> </tr> <tr> <th>132</th> <td>待办</td> </tr> <tr> <th>455</th> <td>没有产权</td> </tr> <tr> <th>...</th> <td>...</td> </tr> <tr> <th>7376</th> <td>家人共有</td> </tr> <tr> <th>7746</th> <td>全家人共有</td> </tr> <tr> <th>7776</th> <td>兄弟共有</td> </tr> <tr> <th>7821</th> <td>未分家，全家所有</td> </tr> <tr> <th>7917</th> <td>家人共有</td> </tr> </tbody> </table> <p>66 rows × 1 columns</p> </div> <p>根据填写情况来看，其中有很多填写信息都是一个意思，例如 <code class="language-plaintext highlighter-rouge">家庭共同所有</code> 和 <code class="language-plaintext highlighter-rouge">全家所有</code> 是同一个意思，但是在python处理中只能一个个的手动处理。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#data_origin.loc[[8009, 9212, 9759, 10517], 'property_other'] = '多人拥有'
#data_origin.loc[[8014, 8056, 10264], 'property_other'] = '未过户'
#data_origin.loc[[8471, 8825, 9597, 9810, 9842, 9967, 10069, 10166, 10203, 10469], 'property_other'] = '全家拥有'
#data_origin.loc[[8553, 8596, 9605, 10421, 10814], 'property_other'] = '无产权'
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">455</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">1415</span><span class="p">,</span> <span class="mi">2511</span><span class="p">,</span> <span class="mi">2792</span><span class="p">,</span> <span class="mi">2956</span><span class="p">,</span> <span class="mi">3647</span><span class="p">,</span> <span class="mi">4147</span><span class="p">,</span> <span class="mi">4193</span><span class="p">,</span> <span class="mi">4589</span><span class="p">,</span> <span class="mi">5023</span><span class="p">,</span> <span class="mi">5382</span><span class="p">,</span> <span class="mi">5492</span><span class="p">,</span> <span class="mi">6102</span><span class="p">,</span> <span class="mi">6272</span><span class="p">,</span> <span class="mi">6339</span><span class="p">,</span> 
                <span class="mi">6507</span><span class="p">,</span> <span class="mi">7184</span><span class="p">,</span> <span class="mi">7239</span><span class="p">],</span> <span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">无产权</span><span class="sh">'</span>
<span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">92</span><span class="p">,</span> <span class="mi">1888</span><span class="p">,</span> <span class="mi">2703</span><span class="p">,</span> <span class="mi">3381</span><span class="p">,</span> <span class="mi">5654</span><span class="p">],</span> <span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">未过户</span><span class="sh">'</span>
<span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">99</span><span class="p">,</span> <span class="mi">619</span><span class="p">,</span> <span class="mi">2728</span><span class="p">,</span> <span class="mi">3062</span><span class="p">,</span> <span class="mi">3222</span><span class="p">,</span> <span class="mi">3251</span><span class="p">,</span> <span class="mi">3696</span><span class="p">,</span> <span class="mi">5283</span><span class="p">,</span> <span class="mi">6191</span><span class="p">,</span> <span class="mi">7295</span><span class="p">,</span> <span class="mi">7376</span><span class="p">,</span> <span class="mi">7746</span><span class="p">,</span> <span class="mi">7821</span><span class="p">,</span> <span class="mi">7917</span><span class="p">],</span> <span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">全家拥有</span><span class="sh">'</span>
<span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">1597</span><span class="p">,</span> <span class="mi">4993</span><span class="p">,</span> <span class="mi">5398</span><span class="p">,</span> <span class="mi">5899</span><span class="p">,</span> <span class="mi">7240</span><span class="p">,</span> <span class="mi">7776</span><span class="p">],</span> <span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">多人拥有</span><span class="sh">'</span>
<span class="n">data_origin</span><span class="p">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">6469</span><span class="p">,</span> <span class="mi">6891</span><span class="p">],</span> <span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">小产权</span><span class="sh">'</span>
</code></pre></div></div> <p>将字符串编码为整数型的序号（ordinal）类型。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">property_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">).</span><span class="n">values</span><span class="p">.</span><span class="n">codes</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div> <p>查看 <code class="language-plaintext highlighter-rouge">invest_other</code> 即 从事的投资活动的填写情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data_origin</span><span class="p">[</span><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">invest_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">invest_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">unique</span><span class="p">())</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>0</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>理财产品</td> </tr> <tr> <th>1</th> <td>民间借贷</td> </tr> <tr> <th>2</th> <td>银行理财</td> </tr> <tr> <th>3</th> <td>储蓄存款</td> </tr> <tr> <th>4</th> <td>理财</td> </tr> <tr> <th>5</th> <td>银行存款利息</td> </tr> <tr> <th>6</th> <td>活期储蓄</td> </tr> <tr> <th>7</th> <td>投资服务业、家具业</td> </tr> <tr> <th>8</th> <td>银行存款</td> </tr> <tr> <th>9</th> <td>个人融资</td> </tr> <tr> <th>10</th> <td>租房</td> </tr> <tr> <th>11</th> <td>老人家不清楚</td> </tr> <tr> <th>12</th> <td>家中有部分土地承包出去</td> </tr> <tr> <th>13</th> <td>没有</td> </tr> <tr> <th>14</th> <td>高利贷</td> </tr> <tr> <th>15</th> <td>彩票</td> </tr> <tr> <th>16</th> <td>自己没有，儿女不清楚</td> </tr> <tr> <th>17</th> <td>网上理财</td> </tr> <tr> <th>18</th> <td>统筹</td> </tr> <tr> <th>19</th> <td>福利车票</td> </tr> <tr> <th>20</th> <td>其他理财产品</td> </tr> <tr> <th>21</th> <td>商业万能保险</td> </tr> <tr> <th>22</th> <td>投资开发区</td> </tr> <tr> <th>23</th> <td>字画、茶壶</td> </tr> </tbody> </table> </div> <p>同样地，将其转换成整数类型的序号（ordinal）编码。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">invest_other</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_origin</span><span class="p">[</span><span class="sh">'</span><span class="s">invest_other</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">).</span><span class="n">values</span><span class="p">.</span><span class="n">codes</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div> <h3 id="离群值处理">离群值处理</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span> <span class="o">=</span> <span class="n">data_origin</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
</code></pre></div></div> <p>画出箱型图分析特征的异常值。</p> <p>并删除离群记录。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">house</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;AxesSubplot:xlabel='house'&gt;
</code></pre></div></div> <p><img src="https://tvax1.sinaimg.cn/large/006VTcCxly1gluiqawemkj309p078dfn.jpg" alt="output_100_1"></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_nona</span><span class="p">[</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">house</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">family_m</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;AxesSubplot:xlabel='family_m'&gt;
</code></pre></div></div> <p><img src="https://tva4.sinaimg.cn/large/006VTcCxly1gluiqflfmrj309p078jr7.jpg" alt="output_102_1"></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_nona</span><span class="p">[</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">family_m</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">inc_exp</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;AxesSubplot:xlabel='inc_exp'&gt;
</code></pre></div></div> <p><img src="https://tvax1.sinaimg.cn/large/006VTcCxly1gluiqk82lqj309p0780sk.jpg" alt="output_104_1"></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_nona</span><span class="p">[</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">inc_exp</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.6e8</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>查看调查时间的月份分布情况，因为调查问卷都是在2015年填写，只需要查看月份的离群点。</p> <p><img src="https://tvax1.sinaimg.cn/large/006VTcCxly1glqnzxouv4j30kh0tkgmv.jpg" alt="图片"></p> <p>由图可知调查问卷是从6月开始的，记录中2月的问卷属于异常数据，应该删除。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">month</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;AxesSubplot:xlabel='survey_time'&gt;
</code></pre></div></div> <p><img src="https://tvax3.sinaimg.cn/large/006VTcCxly1gluiqoqodgj309p078web.jpg" alt="output_107_1"></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">data_nona</span><span class="p">[</span><span class="n">data_nona</span><span class="p">[</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">].</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <h2 id="特征构造">特征构造</h2> <p>特征构造也可称为特征交叉、特征组合、数据变换。</p> <h3 id="连续变量离散化">连续变量离散化</h3> <p>离散化除了一些计算方面等等好处，还可以引入非线性特性，也可以很方便的做cross-feature。离散特征的增加和减少都很容易，易于模型的快速迭代。此外，噪声很大的环境中，离散化可以降低特征中包含的噪声，提升特征的表达能力。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">continuous_list</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>0</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>birth</td> </tr> <tr> <th>1</th> <td>edu_yr</td> </tr> <tr> <th>2</th> <td>income</td> </tr> <tr> <th>3</th> <td>floor_area</td> </tr> <tr> <th>4</th> <td>height_cm</td> </tr> <tr> <th>5</th> <td>weight_jin</td> </tr> <tr> <th>6</th> <td>work_yr</td> </tr> <tr> <th>7</th> <td>family_income</td> </tr> <tr> <th>8</th> <td>family_m</td> </tr> <tr> <th>9</th> <td>house</td> </tr> <tr> <th>10</th> <td>son</td> </tr> <tr> <th>11</th> <td>daughter</td> </tr> <tr> <th>12</th> <td>minor_child</td> </tr> <tr> <th>13</th> <td>marital_1st</td> </tr> <tr> <th>14</th> <td>s_birth</td> </tr> <tr> <th>15</th> <td>marital_now</td> </tr> <tr> <th>16</th> <td>s_income</td> </tr> <tr> <th>17</th> <td>f_birth</td> </tr> <tr> <th>18</th> <td>m_birth</td> </tr> <tr> <th>19</th> <td>inc_exp</td> </tr> <tr> <th>20</th> <td>public_service_1</td> </tr> <tr> <th>21</th> <td>public_service_2</td> </tr> <tr> <th>22</th> <td>public_service_3</td> </tr> <tr> <th>23</th> <td>public_service_4</td> </tr> <tr> <th>24</th> <td>public_service_5</td> </tr> <tr> <th>25</th> <td>public_service_6</td> </tr> <tr> <th>26</th> <td>public_service_7</td> </tr> <tr> <th>27</th> <td>public_service_8</td> </tr> <tr> <th>28</th> <td>public_service_9</td> </tr> </tbody> </table> </div> <p>将连续型变量全部进行分箱，然后对每个区间进行编码，生成新的离散的特征。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">continuous_list</span><span class="p">:</span>
    <span class="n">cut</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">qcut</span><span class="p">(</span><span class="n">data_nona</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="sh">'</span><span class="s">drop</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="n">cut</span><span class="p">.</span><span class="n">values</span>
    <span class="n">codes</span> <span class="o">=</span> <span class="n">cat</span><span class="p">.</span><span class="n">codes</span>
    <span class="n">data_nona</span><span class="p">[</span><span class="n">column</span> <span class="o">+</span> <span class="sh">'</span><span class="s">_discrete</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">codes</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">data_nona</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">pd</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">types</span><span class="p">.</span><span class="nf">is_numeric_dtype</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
        <span class="n">data_nona</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <h2 id="特征选择">特征选择</h2> <p>将连续变量离散化后，生成以后缀 <code class="language-plaintext highlighter-rouge">_discrete</code> 的新特征，所以将原来的连续变量的特征删除掉。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/happiness_train_complete_analysis.csv</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">continuous_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_nona</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/happiness_train_complete_nona.csv</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <h2 id="特征分析">特征分析</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/happiness_train_complete_analysis.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>happiness</th> <th>survey_type</th> <th>province</th> <th>city</th> <th>county</th> <th>survey_time</th> <th>gender</th> <th>birth</th> <th>nationality</th> <th>religion</th> <th>...</th> <th>inc_exp_discrete</th> <th>public_service_1_discrete</th> <th>public_service_2_discrete</th> <th>public_service_3_discrete</th> <th>public_service_4_discrete</th> <th>public_service_5_discrete</th> <th>public_service_6_discrete</th> <th>public_service_7_discrete</th> <th>public_service_8_discrete</th> <th>public_service_9_discrete</th> </tr> <tr> <th>id</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> </tr> </thead> <tbody> <tr> <th>1</th> <td>4</td> <td>1</td> <td>12</td> <td>32</td> <td>59</td> <td>2015-08-04 14:18:00</td> <td>1</td> <td>1959</td> <td>1</td> <td>1</td> <td>...</td> <td>2</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> <tr> <th>2</th> <td>4</td> <td>2</td> <td>18</td> <td>52</td> <td>85</td> <td>2015-07-21 15:04:00</td> <td>1</td> <td>1992</td> <td>1</td> <td>1</td> <td>...</td> <td>2</td> <td>4</td> <td>1</td> <td>2</td> <td>3</td> <td>4</td> <td>1</td> <td>4</td> <td>0</td> <td>0</td> </tr> <tr> <th>3</th> <td>4</td> <td>2</td> <td>29</td> <td>83</td> <td>126</td> <td>2015-07-21 13:24:00</td> <td>2</td> <td>1967</td> <td>1</td> <td>0</td> <td>...</td> <td>3</td> <td>4</td> <td>2</td> <td>3</td> <td>3</td> <td>3</td> <td>4</td> <td>4</td> <td>4</td> <td>2</td> </tr> <tr> <th>4</th> <td>5</td> <td>2</td> <td>10</td> <td>28</td> <td>51</td> <td>2015-07-25 17:33:00</td> <td>2</td> <td>1943</td> <td>1</td> <td>1</td> <td>...</td> <td>0</td> <td>4</td> <td>3</td> <td>2</td> <td>3</td> <td>3</td> <td>4</td> <td>4</td> <td>3</td> <td>2</td> </tr> <tr> <th>5</th> <td>4</td> <td>1</td> <td>7</td> <td>18</td> <td>36</td> <td>2015-08-10 09:50:00</td> <td>2</td> <td>1994</td> <td>1</td> <td>1</td> <td>...</td> <td>4</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p>5 rows × 168 columns</p> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">.</span><span class="nf">describe</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style> <table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>happiness</th> <th>survey_type</th> <th>province</th> <th>city</th> <th>county</th> <th>gender</th> <th>birth</th> <th>nationality</th> <th>religion</th> <th>religion_freq</th> <th>...</th> <th>inc_exp_discrete</th> <th>public_service_1_discrete</th> <th>public_service_2_discrete</th> <th>public_service_3_discrete</th> <th>public_service_4_discrete</th> <th>public_service_5_discrete</th> <th>public_service_6_discrete</th> <th>public_service_7_discrete</th> <th>public_service_8_discrete</th> <th>public_service_9_discrete</th> </tr> </thead> <tbody> <tr> <th>count</th> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>...</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> <td>7968.000000</td> </tr> <tr> <th>mean</th> <td>3.866466</td> <td>1.405120</td> <td>15.158258</td> <td>42.572164</td> <td>70.631903</td> <td>1.530748</td> <td>1964.710216</td> <td>1.399724</td> <td>0.880271</td> <td>1.452560</td> <td>...</td> <td>1.725653</td> <td>1.665537</td> <td>1.272214</td> <td>1.841365</td> <td>1.613328</td> <td>1.848519</td> <td>1.643449</td> <td>1.651732</td> <td>1.654869</td> <td>1.302962</td> </tr> <tr> <th>std</th> <td>0.818844</td> <td>0.490946</td> <td>8.915876</td> <td>27.183764</td> <td>38.736751</td> <td>0.499085</td> <td>16.845155</td> <td>1.466409</td> <td>0.324665</td> <td>1.358444</td> <td>...</td> <td>1.338535</td> <td>1.420309</td> <td>1.108440</td> <td>1.342524</td> <td>1.499494</td> <td>1.297290</td> <td>1.533445</td> <td>1.544477</td> <td>1.511468</td> <td>1.078601</td> </tr> <tr> <th>min</th> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1921.000000</td> <td>1.000000</td> <td>0.000000</td> <td>1.000000</td> <td>...</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> </tr> <tr> <th>25%</th> <td>4.000000</td> <td>1.000000</td> <td>7.000000</td> <td>18.000000</td> <td>37.000000</td> <td>1.000000</td> <td>1952.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>...</td> <td>1.000000</td> <td>0.000000</td> <td>0.000000</td> <td>1.000000</td> <td>0.000000</td> <td>1.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> <td>0.000000</td> </tr> <tr> <th>50%</th> <td>4.000000</td> <td>1.000000</td> <td>15.000000</td> <td>42.000000</td> <td>73.000000</td> <td>2.000000</td> <td>1965.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>...</td> <td>1.000000</td> <td>2.000000</td> <td>1.000000</td> <td>2.000000</td> <td>1.000000</td> <td>2.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> </tr> <tr> <th>75%</th> <td>4.000000</td> <td>2.000000</td> <td>22.000000</td> <td>65.000000</td> <td>104.000000</td> <td>2.000000</td> <td>1977.000000</td> <td>1.000000</td> <td>1.000000</td> <td>1.000000</td> <td>...</td> <td>3.000000</td> <td>2.000000</td> <td>2.000000</td> <td>3.000000</td> <td>3.000000</td> <td>3.000000</td> <td>3.000000</td> <td>3.000000</td> <td>3.000000</td> <td>2.000000</td> </tr> <tr> <th>max</th> <td>5.000000</td> <td>2.000000</td> <td>31.000000</td> <td>89.000000</td> <td>134.000000</td> <td>2.000000</td> <td>1997.000000</td> <td>8.000000</td> <td>1.000000</td> <td>9.000000</td> <td>...</td> <td>4.000000</td> <td>4.000000</td> <td>3.000000</td> <td>4.000000</td> <td>4.000000</td> <td>4.000000</td> <td>4.000000</td> <td>4.000000</td> <td>4.000000</td> <td>3.000000</td> </tr> </tbody> </table> <p>8 rows × 167 columns</p> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null_counts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 7968 entries, 1 to 8000
Data columns (total 168 columns):
 #   Column                     Non-Null Count  Dtype         
---  ------                     --------------  -----         
 0   happiness                  7968 non-null   int64         
 1   survey_type                7968 non-null   int64         
 2   province                   7968 non-null   int64         
 3   city                       7968 non-null   int64         
 4   county                     7968 non-null   int64         
 5   survey_time                7968 non-null   datetime64[ns]
 6   gender                     7968 non-null   int64         
 7   birth                      7968 non-null   int64         
 8   nationality                7968 non-null   int64         
 9   religion                   7968 non-null   int64         
 10  religion_freq              7968 non-null   int64         
 11  edu                        7968 non-null   int64         
 12  edu_other                  7968 non-null   int64         
 13  edu_status                 7968 non-null   int64         
 14  edu_yr                     7968 non-null   int64         
 15  income                     7968 non-null   int64         
 16  political                  7968 non-null   int64         
 17  join_party                 7968 non-null   int64         
 18  floor_area                 7968 non-null   int64         
 19  property_0                 7968 non-null   int64         
 20  property_1                 7968 non-null   int64         
 21  property_2                 7968 non-null   int64         
 22  property_3                 7968 non-null   int64         
 23  property_4                 7968 non-null   int64         
 24  property_5                 7968 non-null   int64         
 25  property_6                 7968 non-null   int64         
 26  property_7                 7968 non-null   int64         
 27  property_8                 7968 non-null   int64         
 28  property_other             7968 non-null   int64         
 29  height_cm                  7968 non-null   int64         
 30  weight_jin                 7968 non-null   int64         
 31  health                     7968 non-null   int64         
 32  health_problem             7968 non-null   int64         
 33  depression                 7968 non-null   int64         
 34  hukou                      7968 non-null   int64         
 35  hukou_loc                  7968 non-null   int64         
 36  media_1                    7968 non-null   int64         
 37  media_2                    7968 non-null   int64         
 38  media_3                    7968 non-null   int64         
 39  media_4                    7968 non-null   int64         
 40  media_5                    7968 non-null   int64         
 41  media_6                    7968 non-null   int64         
 42  leisure_1                  7968 non-null   int64         
 43  leisure_2                  7968 non-null   int64         
 44  leisure_3                  7968 non-null   int64         
 45  leisure_4                  7968 non-null   int64         
 46  leisure_5                  7968 non-null   int64         
 47  leisure_6                  7968 non-null   int64         
 48  leisure_7                  7968 non-null   int64         
 49  leisure_8                  7968 non-null   int64         
 50  leisure_9                  7968 non-null   int64         
 51  leisure_10                 7968 non-null   int64         
 52  leisure_11                 7968 non-null   int64         
 53  leisure_12                 7968 non-null   int64         
 54  socialize                  7968 non-null   int64         
 55  relax                      7968 non-null   int64         
 56  learn                      7968 non-null   int64         
 57  social_neighbor            7968 non-null   int64         
 58  social_friend              7968 non-null   int64         
 59  socia_outing               7968 non-null   int64         
 60  equity                     7968 non-null   int64         
 61  class                      7968 non-null   int64         
 62  class_10_before            7968 non-null   int64         
 63  class_10_after             7968 non-null   int64         
 64  class_14                   7968 non-null   int64         
 65  work_exper                 7968 non-null   int64         
 66  work_status                7968 non-null   int64         
 67  work_yr                    7968 non-null   int64         
 68  work_type                  7968 non-null   int64         
 69  work_manage                7968 non-null   int64         
 70  insur_1                    7968 non-null   int64         
 71  insur_2                    7968 non-null   int64         
 72  insur_3                    7968 non-null   int64         
 73  insur_4                    7968 non-null   int64         
 74  family_income              7968 non-null   int64         
 75  family_m                   7968 non-null   int64         
 76  family_status              7968 non-null   int64         
 77  house                      7968 non-null   int64         
 78  car                        7968 non-null   int64         
 79  invest_0                   7968 non-null   int64         
 80  invest_1                   7968 non-null   int64         
 81  invest_2                   7968 non-null   int64         
 82  invest_3                   7968 non-null   int64         
 83  invest_4                   7968 non-null   int64         
 84  invest_5                   7968 non-null   int64         
 85  invest_6                   7968 non-null   int64         
 86  invest_7                   7968 non-null   int64         
 87  invest_8                   7968 non-null   int64         
 88  invest_other               7968 non-null   int64         
 89  son                        7968 non-null   int64         
 90  daughter                   7968 non-null   int64         
 91  minor_child                7968 non-null   int64         
 92  marital                    7968 non-null   int64         
 93  marital_1st                7968 non-null   int64         
 94  s_birth                    7968 non-null   int64         
 95  marital_now                7968 non-null   int64         
 96  s_edu                      7968 non-null   int64         
 97  s_political                7968 non-null   int64         
 98  s_hukou                    7968 non-null   int64         
 99  s_income                   7968 non-null   int64         
 100 s_work_exper               7968 non-null   int64         
 101 s_work_status              7968 non-null   int64         
 102 s_work_type                7968 non-null   int64         
 103 f_birth                    7968 non-null   int64         
 104 f_edu                      7968 non-null   int64         
 105 f_political                7968 non-null   int64         
 106 f_work_14                  7968 non-null   int64         
 107 m_birth                    7968 non-null   int64         
 108 m_edu                      7968 non-null   int64         
 109 m_political                7968 non-null   int64         
 110 m_work_14                  7968 non-null   int64         
 111 status_peer                7968 non-null   int64         
 112 status_3_before            7968 non-null   int64         
 113 view                       7968 non-null   int64         
 114 inc_ability                7968 non-null   int64         
 115 inc_exp                    7968 non-null   int64         
 116 trust_1                    7968 non-null   int64         
 117 trust_2                    7968 non-null   int64         
 118 trust_3                    7968 non-null   int64         
 119 trust_4                    7968 non-null   int64         
 120 trust_5                    7968 non-null   int64         
 121 trust_6                    7968 non-null   int64         
 122 trust_7                    7968 non-null   int64         
 123 trust_8                    7968 non-null   int64         
 124 trust_9                    7968 non-null   int64         
 125 trust_10                   7968 non-null   int64         
 126 trust_11                   7968 non-null   int64         
 127 trust_12                   7968 non-null   int64         
 128 trust_13                   7968 non-null   int64         
 129 neighbor_familiarity       7968 non-null   int64         
 130 public_service_1           7968 non-null   int64         
 131 public_service_2           7968 non-null   int64         
 132 public_service_3           7968 non-null   int64         
 133 public_service_4           7968 non-null   int64         
 134 public_service_5           7968 non-null   int64         
 135 public_service_6           7968 non-null   int64         
 136 public_service_7           7968 non-null   int64         
 137 public_service_8           7968 non-null   int64         
 138 public_service_9           7968 non-null   int64         
 139 birth_discrete             7968 non-null   int64         
 140 edu_yr_discrete            7968 non-null   int64         
 141 income_discrete            7968 non-null   int64         
 142 floor_area_discrete        7968 non-null   int64         
 143 height_cm_discrete         7968 non-null   int64         
 144 weight_jin_discrete        7968 non-null   int64         
 145 work_yr_discrete           7968 non-null   int64         
 146 family_income_discrete     7968 non-null   int64         
 147 family_m_discrete          7968 non-null   int64         
 148 house_discrete             7968 non-null   int64         
 149 son_discrete               7968 non-null   int64         
 150 daughter_discrete          7968 non-null   int64         
 151 minor_child_discrete       7968 non-null   int64         
 152 marital_1st_discrete       7968 non-null   int64         
 153 s_birth_discrete           7968 non-null   int64         
 154 marital_now_discrete       7968 non-null   int64         
 155 s_income_discrete          7968 non-null   int64         
 156 f_birth_discrete           7968 non-null   int64         
 157 m_birth_discrete           7968 non-null   int64         
 158 inc_exp_discrete           7968 non-null   int64         
 159 public_service_1_discrete  7968 non-null   int64         
 160 public_service_2_discrete  7968 non-null   int64         
 161 public_service_3_discrete  7968 non-null   int64         
 162 public_service_4_discrete  7968 non-null   int64         
 163 public_service_5_discrete  7968 non-null   int64         
 164 public_service_6_discrete  7968 non-null   int64         
 165 public_service_7_discrete  7968 non-null   int64         
 166 public_service_8_discrete  7968 non-null   int64         
 167 public_service_9_discrete  7968 non-null   int64         
dtypes: datetime64[ns](1), int64(167)
memory usage: 10.3 MB
</code></pre></div></div> <p>首先，查看 <code class="language-plaintext highlighter-rouge">happiness</code> 幸福程度的分布，可以发现多数人都属于 <code class="language-plaintext highlighter-rouge">比较幸福</code> 的程度。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">darkgrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">displot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">facet_kws</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span><span class="n">margin_titles</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x25128009850&gt;
</code></pre></div></div> <p><img src="https://tvax1.sinaimg.cn/large/006VTcCxly1gluiqwsiiyj30as07ojrg.jpg" alt="output_129_1"></p> <p>查看每个人的收入和幸福度的散点图，通过散点图可以看出随着收入的提高，大多数点都落在了较高的幸福程度上；即使如此，也会发现存在一些收入非常高的人也处在一个说不上幸福不幸福的程度。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">whitegrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">despine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">income</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="sh">"</span><span class="s">income</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">ch:r=-.2,d=.3_r</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;AxesSubplot:xlabel='happiness', ylabel='income'&gt;
</code></pre></div></div> <p><img src="https://tva4.sinaimg.cn/large/006VTcCxly1gluir1cockj30jo09oaa2.jpg" alt="output_131_1"></p> <p>查看性别男女的幸福程度的分布直方图，在性别特征上没有过多的类别不平衡情况。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">darkgrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">displot</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="sh">"</span><span class="s">gender</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">facet_kws</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span><span class="n">margin_titles</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x25128b8e1f0&gt;
</code></pre></div></div> <p><img src="https://tvax2.sinaimg.cn/large/006VTcCxly1gluir5sx8nj30a20a2aad.jpg" alt="output_133_1"></p> <p>通过直线图，可以看出，随着 <code class="language-plaintext highlighter-rouge">edu</code> 受到的教育的提高，幸福程度也随之提升。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">ticks</span><span class="sh">"</span><span class="p">)</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">color_palette</span><span class="p">(</span><span class="sh">"</span><span class="s">rocket_r</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">relplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">edu</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">line</span><span class="sh">"</span><span class="p">,</span> <span class="n">size_order</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">T1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">T2</span><span class="sh">"</span><span class="p">],</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
    <span class="n">facet_kws</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x251284bdeb0&gt;
</code></pre></div></div> <p><img src="https://tva4.sinaimg.cn/large/006VTcCxly1gluira4bwsj30bb07pweh.jpg" alt="output_135_0"></p> <p>查看每个幸福程度的出生日期，可以看出，不同幸福程度的年代的人分布都是大同小异的。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">ticks</span><span class="sh">"</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">pastel</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">birth</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p><img src="https://tvax3.sinaimg.cn/large/006VTcCxly1gluirnib0sj30bb07pweh.jpg" alt="output_135_0"></p> <p>将记录分为是否信仰宗教信仰，查看幸福度和健康状况的分裂小提琴图，也可以看出一个趋势，幸福度高的人大多数都分布在较高的健康状况上，而且也可以看出一个现象，随着健康状况和幸福度的提高，信仰宗教信仰的人数也慢慢增加。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">whitegrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">violinplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">health</span><span class="sh">"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">"</span><span class="s">religion</span><span class="sh">"</span><span class="p">,</span>
               <span class="n">split</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="sh">"</span><span class="s">quart</span><span class="sh">"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p><img src="https://tvax3.sinaimg.cn/large/006VTcCxly1gluirqo1q2j30ai07dt95.jpg" alt="output_137_0"></p> <p>绘制一个多变量分布直方图，可以看出大多数比较幸福的人，房产的数量也不会大幅增加。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">ticks</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nc">JointGrid</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">house</span><span class="sh">"</span><span class="p">,</span> <span class="n">marginal_ticks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Set a log scaling on the y axis
</span><span class="n">g</span><span class="p">.</span><span class="n">ax_joint</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="sh">"</span><span class="s">linear</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Create an inset legend for the histogram colorbar
</span><span class="n">cax</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">fig</span><span class="p">.</span><span class="nf">add_axes</span><span class="p">([.</span><span class="mi">15</span><span class="p">,</span> <span class="p">.</span><span class="mi">55</span><span class="p">,</span> <span class="p">.</span><span class="mi">02</span><span class="p">,</span> <span class="p">.</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># Add the joint and marginal histogram plots
</span><span class="n">g</span><span class="p">.</span><span class="nf">plot_joint</span><span class="p">(</span>
    <span class="n">sns</span><span class="p">.</span><span class="n">histplot</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="sh">"</span><span class="s">light:#03012d</span><span class="sh">"</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cbar_ax</span><span class="o">=</span><span class="n">cax</span>
<span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">plot_marginals</span><span class="p">(</span><span class="n">sns</span><span class="p">.</span><span class="n">histplot</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="sh">"</span><span class="s">step</span><span class="sh">"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">#03012d</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.JointGrid at 0x251288fee20&gt;
</code></pre></div></div> <p><img src="https://tvax3.sinaimg.cn/large/006VTcCxly1gluirv4qmoj30bi0bo3yi.jpg" alt="output_139_1"></p> <p>绘制幸福度和住房建筑面积的核密度估计图，可以看出同样的现象，多数比较幸福的人的房屋建筑面积也不会集中在很高的一个水平，但是也会有一个随着房屋建筑面积的增加幸福度也增加的现象。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">ticks</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">floor_area</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">floor_area</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">kde</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div> <p><img src="https://tva2.sinaimg.cn/large/006VTcCxly1gluis0b5pmj30br0boq48.jpg" alt="output_141_0"></p> <p>查看各个特征的热力图，可以根据图中的颜色深度看出两两特征之间的相关性的高低。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">whitegrid</span><span class="sh">"</span><span class="p">)</span>
<span class="n">corr_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">survey_type</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">county</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">gender</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">birth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">nationality</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">religion</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">religion_freq</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">edu</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">income</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">political</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">floor_area</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">height_cm</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">weight_jin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">health</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">health_problem</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">depression</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">hukou</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">socialize</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">relax</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">learn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">equity</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">class</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_exper</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_status</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_yr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">work_type</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">work_manage</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_income</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_m</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">family_status</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">house</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">car</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">marital</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">status_peer</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">status_3_before</span><span class="sh">'</span><span class="p">,</span> 
                 <span class="sh">'</span><span class="s">view</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">inc_ability</span><span class="sh">'</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">corr_mat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">corr_list</span><span class="p">].</span><span class="nf">corr</span><span class="p">().</span><span class="nf">stack</span><span class="p">().</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">correlation</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">relplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">corr_mat</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">level_0</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">level_1</span><span class="sh">"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">"</span><span class="s">correlation</span><span class="sh">"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="sh">"</span><span class="s">correlation</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">vlag</span><span class="sh">"</span><span class="p">,</span> <span class="n">hue_norm</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">"</span><span class="s">.7</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">size_norm</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="p">.</span><span class="mi">8</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="sh">"</span><span class="s">equal</span><span class="sh">"</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="n">ax</span><span class="p">.</span><span class="nf">margins</span><span class="p">(.</span><span class="mi">02</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">g</span><span class="p">.</span><span class="n">ax</span><span class="p">.</span><span class="nf">get_xticklabels</span><span class="p">():</span>
    <span class="n">label</span><span class="p">.</span><span class="nf">set_rotation</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">g</span><span class="p">.</span><span class="n">legend</span><span class="p">.</span><span class="n">legendHandles</span><span class="p">:</span>
    <span class="n">artist</span><span class="p">.</span><span class="nf">set_edgecolor</span><span class="p">(</span><span class="sh">"</span><span class="s">.7</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p><img src="https://tvax2.sinaimg.cn/large/006VTcCxly1gluis5x3nzj30lf0jkn7w.jpg" alt="output_143_0"></p> <p>查看全国省会城市的幸福人数的占比条形图，通过图中可以看出，湖北省调查人数最多但幸福人数不算高；河南省和山东省的幸福人数的占比非常之高；即使内蒙古自治区的调查人数最少，但是幸福人数的占比却是非常高的。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">whitegrid</span><span class="sh">"</span><span class="p">)</span>

<span class="n">province_total</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">].</span><span class="nf">groupby</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">]).</span><span class="nf">count</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">to_frame</span><span class="p">()</span>
<span class="n">province_total</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">total</span><span class="sh">'</span><span class="p">]</span>
<span class="n">happiness_involved</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">province_total</span><span class="p">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">happiness_involved</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="sh">'</span><span class="s">happiness</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">happiness_involved</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">happiness_involved</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">province_total</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">happiness_involved</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">involved</span><span class="sh">'</span><span class="p">]</span>
<span class="n">province_total</span><span class="p">[</span><span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">province_total</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">map</span><span class="p">({</span>
    <span class="mi">1</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Shanghai</span><span class="sh">'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Yunnan</span><span class="sh">'</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Neimeng</span><span class="sh">'</span><span class="p">,</span> <span class="mi">4</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Beijing</span><span class="sh">'</span><span class="p">,</span> <span class="mi">5</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Jilin</span><span class="sh">'</span><span class="p">,</span> <span class="mi">6</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Sichuan</span><span class="sh">'</span><span class="p">,</span> <span class="mi">7</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Tianjin</span><span class="sh">'</span><span class="p">,</span> <span class="mi">8</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Ningxia</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">9</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Anhui</span><span class="sh">'</span><span class="p">,</span> <span class="mi">10</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Shandong</span><span class="sh">'</span><span class="p">,</span> <span class="mi">11</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Shanxi</span><span class="sh">'</span><span class="p">,</span> <span class="mi">12</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Guangdong</span><span class="sh">'</span><span class="p">,</span> <span class="mi">13</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Guangxi</span><span class="sh">'</span><span class="p">,</span> <span class="mi">14</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Xinjiang</span><span class="sh">'</span><span class="p">,</span> <span class="mi">15</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Jiangsu</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">16</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Jiangxi</span><span class="sh">'</span><span class="p">,</span> <span class="mi">17</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Hebei</span><span class="sh">'</span><span class="p">,</span> <span class="mi">18</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Henan</span><span class="sh">'</span><span class="p">,</span> <span class="mi">19</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Zhejiang</span><span class="sh">'</span><span class="p">,</span> <span class="mi">20</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Hainan</span><span class="sh">'</span><span class="p">,</span> <span class="mi">21</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Hubei</span><span class="sh">'</span><span class="p">,</span> <span class="mi">22</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Hunan</span><span class="sh">'</span><span class="p">,</span> <span class="mi">23</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Gansu</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">24</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Fujian</span><span class="sh">'</span><span class="p">,</span> <span class="mi">25</span> <span class="p">:</span> <span class="sh">'</span><span class="s">XIzang</span><span class="sh">'</span><span class="p">,</span> <span class="mi">26</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Guizhou</span><span class="sh">'</span><span class="p">,</span> <span class="mi">27</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Liangning</span><span class="sh">'</span><span class="p">,</span> <span class="mi">28</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Chongqing</span><span class="sh">'</span><span class="p">,</span> <span class="mi">29</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Shaanxi</span><span class="sh">'</span><span class="p">,</span> <span class="mi">30</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Qinghai</span><span class="sh">'</span><span class="p">,</span> <span class="mi">31</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Heilongjiang</span><span class="sh">'</span><span class="p">})</span>
<span class="n">happiness_involved</span><span class="p">[</span><span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">province_total</span><span class="p">[</span><span class="sh">'</span><span class="s">province</span><span class="sh">'</span><span class="p">]</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

<span class="n">sns</span><span class="p">.</span><span class="nf">set_color_codes</span><span class="p">(</span><span class="sh">"</span><span class="s">pastel</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">province</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">province_total</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">Total</span><span class="sh">"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">)</span>

<span class="n">sns</span><span class="p">.</span><span class="nf">set_color_codes</span><span class="p">(</span><span class="sh">"</span><span class="s">muted</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">involved</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">province</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">happiness_involved</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">Alcohol-involved</span><span class="sh">"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="sh">"</span><span class="s">lower right</span><span class="sh">"</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sh">"</span><span class="s">Happiness of every province</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p><img src="https://tva1.sinaimg.cn/large/006VTcCxly1gluisdlaayj30bn0nzq3i.jpg" alt="output_145_0"></p> <p>查看调查对象认为的当今社会的公平度中的幸福人数占比的直方图，多数调查对象认为当今社会是出于一个比较公平的，但仍有近半数人认为不算太公平。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">ticks</span><span class="sh">"</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">despine</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">histplot</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">'</span><span class="s">happiness</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">equity</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">multiple</span><span class="o">=</span><span class="sh">"</span><span class="s">stack</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">light:m_r</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="sh">"</span><span class="s">.3</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span>
<span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;AxesSubplot:xlabel='equity', ylabel='Count'&gt;
</code></pre></div></div> <p><img src="https://tvax2.sinaimg.cn/large/006VTcCxly1gluisidlpgj30ck08vgln.jpg" alt="output_147_1"></p> <p>根据多变量的散点图，幸福度高的人的都均匀地分布在了不同身高、体重的地方；体形没有太大地影响幸福度。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">white</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">relplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">height_cm</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">weight_jin</span><span class="sh">"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="sh">"</span><span class="s">health</span><span class="sh">"</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="sh">"</span><span class="s">muted</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x2512b5a2ca0&gt;
</code></pre></div></div> <p><img src="https://tvax3.sinaimg.cn/large/006VTcCxly1gluitymatej30c10a2tah.jpg" alt="output_149_1"></p> <p>绘制一个带有误差带的直线图，横轴表示幸福度的提升，纵轴表示期待的年收入的提升，可以看出，在幸福度比较低的人期待的年收入通常会很高并带有非常大的误差，随着幸福度的提升每个人期待的年收入也没有变得更高，并且随之误差带也变小了。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">ticks</span><span class="sh">"</span><span class="p">)</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">color_palette</span><span class="p">(</span><span class="sh">"</span><span class="s">rocket_r</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">relplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">happiness</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">inc_exp</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">line</span><span class="sh">"</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="p">.</span><span class="mi">75</span><span class="p">,</span> <span class="n">facet_kws</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x2512b5e8d90&gt;
</code></pre></div></div> <p><img src="https://tva4.sinaimg.cn/large/006VTcCxly1gluitcspw0j307k0a274e.jpg" alt="output_151_1"></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div> <h2 id="模型建立">模型建立</h2> <h3 id="xgboost-模型介绍">XGBoost 模型介绍</h3> <p><strong>XGBoost</strong> 是一个具有高效、灵活和可移植性的经过优化的分布式 <strong>梯度提升</strong> 库。它的实现是基于机器学习算法梯度提升框架。XGBoost 提供了并行的提升树（例如GBDT、GBM）以一个非常快速并且精准的方法解决了许多的数据科学问题。相同的代码可以运行在主流的分布式环境（如Hadoop、SGE、MPI）并且可以处理数十亿的样本。</p> <p>XGBoost代表了极端梯度提升（Extreme Gradient Boosting）。</p> <h3 id="集成决策树">集成决策树</h3> <p>首先了解XGBoost的模型选择：集成决策树。树的集成模型是由CART（classification and regression trees）的集合组成。下面一张图简单说明了一个CART分出某个人是否喜欢玩电脑游戏的例子。</p> <p><img src="https://tva1.sinaimg.cn/large/006VTcCxly1glthktr3jaj30of0b0428.jpg" alt="图片"></p> <p>将每个家庭成员分到不同的叶子结点上，并赋给他们一个分数，每一个叶结点对应了一个分数。CART与决策树是略有不同的，决策树中每个叶结点只包含了一个决策值。在CART上，真实的分数是与叶结点关联的，可以给出比分类更丰富的解释。这也允许了更具有原则、更一致性的优化方法。</p> <p>通常，在实践中一个单独的树是不够强大的。实际上使用的是集成模型，将多个树的预测结果汇总到一起。</p> <p><img src="https://tva3.sinaimg.cn/large/006VTcCxly1glthl2n9g2j30pa0cs77j.jpg" alt="图片"></p> <p>上图中是一个由两棵树集成在一起的例子。每一个树的预测分数被加到一起得到最终的分数。一个重要的因素是两棵树努力补足彼此。可以写出模型：</p> \[\hat{y}_i=\sum_{k=1}^Kf_k\left (x_i\right ),f_k\in\mathcal{F}\] <p>其中，\(K\) 是树的数量，\(f\) 是一个在函数空间 \(\mathcal{F}\) 的函数，并且 \(\mathcal{F}\) 是一个所有可能的CART的集合。可被优化的目标函数为：</p> \[\mathit{obj}\left (\theta\right )=\sum_i^n\ell\left (y_i,\hat{y}_i\right )+\sum_{k=1}^K\Omega\left (f_k\right )\] <p>随机森林和提升树实际上都是相同的模型；不同之处是如何去训练它们。如果需要一个用来预测的集成树，只需要写出一个并其可以工作在随机森林和提升树上。</p> <h3 id="提升树">提升树</h3> <p>正如同所有的监督学习一样，想要训练树就要先定义目标函数并优化它。</p> <p>一个目标函数要总是包含训练的损失度和正则化项。</p> \[\mathit{obj}=\sum_i^n\ell\left (y_i,\hat{y}_i\right )+\sum_{k=1}^K\Omega\left (f_k\right )\] <h3 id="加性训练">加性训练</h3> <p>树需要训练的参数有 \(f_i\) 每一个都包含了树的结构和叶结点的得分。训练树的结构是比传统的可以直接采用梯度的优化问题更难。一次性训练并学习到所有的树是非常棘手的。相反地，可以采取一个附加的策略，修正已经学习到的，同时增加一课新树。可以写出在第 \(t\) 步的预测值 \(\hat{y}_i^\left(t\right )\)</p> \[\begin{split} \hat{y}_i^{\left (0\right )}&amp;=0\\ \hat{y}_i^{\left (1\right )}&amp;=f_1\left (x_i\right )=\hat{y}_i^{\left (0\right )}+f_1\left (x_i\right )\\ \hat{y}_i^{\left (2\right )}&amp;=f_1\left (x_i\right )+f_2\left (x_i\right )=\hat{y}_i^{\left (1\right )}+f_2\left (x_i\right )\\ &amp;\dots\\ \hat{y}_i^{\left (t\right )}&amp;=\sum_{k=1}^Kf_k\left (x_i\right )=\hat{y}_i^{\left (t-1\right )}+f_t\left (x_i\right )\\ \end{split}\] <p>在每一步需要什么的树，增加一棵树，优化目标函数。</p> \[\begin{split} \mathit{obj}^{(t)}&amp;=\sum_{i=1}^n\ell(y_i,\hat{y}_i^{(t)})+\sum_{i=1}^t\Omega(f_i)\\ &amp;=\sum_{i=1}^n\ell(y_i,\hat{y}^{(t-1)}_i+f_t(x_i))+\Omega(f_t)+C \end{split}\] <p>如果考虑使用均方误差（MSE）作为损失函数，目标函数将会变成：</p> \[\begin{split} \mathit{obj}^{(t)}&amp;=\sum_{i=1}^n\ell(y_i,\hat{y}^{(t-1)}_i+f_t(x_i))+\Omega(f_t)+C\\ &amp;=\sum_{i=1}^n(y_i-(\hat{y}_i^{(t-1)}+f_t(x_i)))^2+\Omega(f_t)+C\\ &amp;=\sum_{i=1}^n((y_i-\hat{y}_i^{(t-1)})-f_t(x_i))^2+\Omega(f_t)+C\\ &amp;=\sum_{i=1}^n((y_i-\hat{y}_i^{(t-1)})^2-2(y_i-\hat{y}_i^{(t-1)})f_t(x_i)+f_t(x_i)^2)+\Omega(f_t)+C\\ &amp;=\sum_{i=1}^n(-2(y_i-\hat{y}_i^{(t-1)})f_t(x_i)+f_t(x_i)^2)+\Omega(f_t)+C\\ \end{split}\] <p>MSE的形式是非常优雅的，其中有一个一阶项（通常称作残差）和一个二阶项。对于其它的损失函数（例如logistic的损失函数）而言，是没有那么轻易就可以得到如此优雅的形式。因此，通常会使用泰勒公式损失函数展开到二阶项：</p> <blockquote> <p>泰勒公式：函数 \(f(x)\) 在开区间 \((a,b)\) 上具有 \((n+1)\) 阶导数，对于任一 \(x\in(a,b)\) 有 \(f(x)=\frac{f(x_0)}{0!}+\frac{f'(x_0)}{1!}(x-x_0)+\frac{f''(x_0)}{2!}(x-x_0)^2+\dots+\frac{f^{(n)}(x_0)}{n!}(x-x_0)^n+R_n(x)\)</p> </blockquote> \[\begin{split} \mathit{obj}^{(t)}&amp;=\sum_{i=1}^n\ell(y_i,\hat{y}^{(t-1)}_i+f_t(x_i))+\Omega(f_t)+C\\ &amp;=\sum_{i=1}^n[\frac{\ell(y_i,\hat{y}^{(t-1)}_i)}{0!}+\frac{\ell'(y_i,\hat{y}^{(t-1)}_i)}{1!}(\hat{y}^{(t)}_i-\hat{y}^{(t-1)}_i)+\frac{\ell''(y_i,\hat{y}^{(t-1)}_i)}{2!}(\hat{y}^{(t)}_i-\hat{y}^{(t-1)}_i)^2]+\Omega(f_t)+C\\ &amp;=\sum_{i=1}^n[\ell(y_i,\hat{y}^{(t-1)}_i)+\ell'(y_i,\hat{y}^{(t-1)}_i)f_t(x_i)+\frac{1}{2}\ell''(y_i,\hat{y}^{(t-1)}_i)f_t(x_i)^2]+\Omega(f_t)+C\\ &amp;=\sum_{i=1}^n[\ell(y_i,\hat{y}^{(t-1)}_i)+g_if_t(x_i)+\frac{1}{2}h_if_t(x_i)^2]+\Omega(f_t)+C\\ \end{split}\] <p>其中，\(g_i\) 和 \(h_i\) 被定义为：</p> \[\begin{split} g_i&amp;=\partial_{\hat{y}_i^{(t-1)}}\ell(y_i,\hat{y}^{(t-1)}_i)\\ h_i&amp;=\partial^2_{\hat{y}^{(t-1)}_i}\ell(y_i,\hat{y}^{(t-1)}_i) \end{split}\] <p>移除所有的常量，在第 \(t\) 步的目标函数就成了：</p> \[\sum_{i=1}^n[g_if_t(x_i)+\frac{1}{2}h_if_t(x_i)^2]+\Omega(f_t)\] <p>这就成了对于一颗新树的优化目标。一个非常重要的优势就是这个定义的目标函数的值只依赖于 \(g_i\) 和 \(h_i\) 这正是XGBoost支持自定义损失函数。可以优化各种损失函数，包括逻辑回归和成对排名（pairwise ranking），使用 \(g_i\) 和 \(h_i\) 作为输入的完全相同的求解器求解。</p> <h3 id="模型复杂度">模型复杂度</h3> <p>定义树的复杂度 \(\Omega(f)\) 。首先提炼出树的定义 \(f(x)\) 为：</p> \[f_t(x)=w_{q(x)},w\in\mathbb{R}^T,q:\mathbb{R}^d\rightarrow \{1,2,\dots,T\}.\] <p>其中 \(w\) 是叶结点上的得分向量，\(q\) 是一个将每一个数据点分配到对应的叶结点上的函数，\(T\) 是叶结点的数量。在XGBoost中，定义复杂度为：</p> \[\Omega(f)=\gamma T+\frac{1}{2}\lambda\sum_{j=1}^Tw_j^2\] <p>有不止一个方法定义复杂度，但是这种方式在实践中可以表现的很好。正则化项是大多数树包都会被忽略的一部分。这是因为传统的树学习的对待仅仅强调改善杂质，模型的复杂度的控制留给了启发式。通过正式的定义它，可以更好的理解模型并使模型的表现更具有泛化能力。</p> <h3 id="树的结构分数">树的结构分数</h3> <p>通过对树模型的目标函数的推导，可以得到在第 \(t\) 步的树的目标值：</p> \[\begin{split} \mathit{obj}^{(t)}&amp;\approx\sum_{i=1}^n[g_iw_{q(x_i)}+\frac{1}{2}h_iw^2_{q(x_i)}]+\gamma T+\frac{1}{2}\lambda\sum_{j=1}^Tw_j^2\\ &amp;=[g_1w_{q(x_1)}+\frac{1}{2}h_1w^2_{q(x_1)}+g_2w_{q(x_2)}+\frac{1}{2}h_2w^2_{q(x_2)}+\dots+g_nw_{q(x_n)}+\frac{1}{2}h_nw^2_{q(x_n)}]+\gamma T+\frac{1}{2}\lambda\sum_{j=1}^Tw_j^2\\ &amp;=\sum_{j=1}^T[(\sum_{i\in I_j}g_i)w_j+\frac{1}{2}(\sum_{i\in I_j}h_i)w^2_j]+\gamma T+\frac{1}{2}\lambda\sum_{j=1}^Tw_j^2\\ &amp;=\sum_{j=1}^T[(\sum_{i\in I_j}g_i)w_j+\frac{1}{2}(\sum_{i\in I_j}h_i)w^2_j+\frac{1}{2}\lambda w_j^2]+\gamma T\\ &amp;=\sum_{j=1}^T[(\sum_{i\in I_j}g_i)w_j+\frac{1}{2}(\sum_{i\in I_j}h_i+\lambda)w^2_j]+\gamma T\\ \end{split}\] <table> <tbody> <tr> <td>其中 $$I_j={i</td> <td>q(x_i)=j}\(是第\)i\(个数据点被分配到第\)j\(个叶结点上的下标集合。改变了其累加的索引，因为被分配到相同的叶结点上的数据点得到的分数是统一的。进一步压缩表达令\)G_j=\sum_{i\in I_j}g_i\(和\)H_j=\sum_{i\in I_j}h_i$$</td> </tr> </tbody> </table> \[\mathit{obj}^{(t)}=\sum_{j=1}^T[G_jw_j+\frac{1}{2}(H_j+\lambda)w_j^2]+\gamma T\] <p>其中，\(w_j\) 是彼此独立的，式子 \(G_jw_j+\frac{1}{2}(H_j+\lambda)w_j^2\) 是二次的，并且对于给定的结构 \(q(x)\) 最好的 \(w_j\) 和可以得到的最佳的目标规约为：</p> \[\begin{split} w_j\ast&amp;=-\frac{G_j}{H_j+\lambda}\\ \mathit{obj}\ast&amp;=-\frac{1}{2}\sum_{j=1}^T\frac{G_j^2}{H_j+\lambda}+\gamma T \end{split}\] <p>此公式衡量了一棵树的结构 \(q(x)\) 有多好。</p> <p><img src="https://tva3.sinaimg.cn/large/006VTcCxly1gluepukhuij30pk0bp769.jpg" alt="图片"></p> <p>基本上，对于一颗给定的树结构，将统计量 \(g_i\) 和 \(h_i\) 推到它们所属的叶结点上，并将它们累加到一起，使用公式计算衡量这棵树多好。这个分数类似于决策树中的不纯度度量（impurity measure），区别之处在于它还将模型复杂度考虑在内。</p> <h3 id="学习树的结构">学习树的结构</h3> <p>现在已经有了衡量一棵树好坏的指标，一个典型的想法是枚举所有可能的树并从中挑出最好的一个。实际上这是非常棘手的，所以应该尝试一次优化树的一个级别。具体来说，是将一个子结点分割成两个叶结点，得分增益为：</p> \[\mathit{Gain}=\frac{1}{2}\left [\frac{G_L^2}{H_L+\lambda}+\frac{G_R^2}{H_R+\lambda}-\frac{(G_L+G_R)^2}{H_L+H_R+\lambda}\right]-\gamma\] <p>这个公式可以被分解为几个部分，一部分是在新左子结点的得分，第二部分是在新右子结点上的得分，第三部分是原先叶结点上的得分，第四部分是在新叶结点上的正则化项。可以看到非常重要的因素是，如果增益小于 \(\gamma\) 更好的选择是不去分割出一个新分支。这就是基本的树模型的剪枝（pruning）技术。</p> <p>对于实际中的数据，通常想要搜索一个最优的分割点。一个高效率的做法是，将所有的实例（记录）排好序，如下图示。</p> <p><img src="https://tva2.sinaimg.cn/large/006VTcCxly1gluff5qs2hj30gp05iq41.jpg" alt="图片"></p> <p>从左到右扫描计算所有分割方案的结构分数是非常高效的，并且可以快速地找出最优的分割点。</p> <blockquote> <p>加性数训练的限制</p> <p>因为将所有可能的树结构枚举出来是非常棘手的，所以每次增加一个分割点（split）。这个方法在大多数情况下运行的很好，但是有一些边缘案例导致这个方法失效。对于退化模型的训练结果，每次仅仅考虑一个特征维度。参考<a href="http://mariofilho.com/can-gradient-boosting-learn-simple-arithmetic/" rel="external nofollow noopener" target="_blank">Can Gradient Boosting Learn Simple Arithmetic?</a></p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/happiness_train_complete_nona.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">])</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/happiness_test_complete_nona.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">])</span>
<span class="n">submit</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/happiness_submit.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">happiness</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="sh">'</span><span class="s">happiness</span><span class="sh">'</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="n">xgboost</span> <span class="kn">import</span> <span class="n">plot_importance</span>

<span class="n">model</span> <span class="o">=</span> <span class="nc">XGBRegressor</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.4596381608913307
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">xgboost</span> <span class="kn">import</span> <span class="n">plot_importance</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
<span class="nf">plot_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span><span class="err">`</span>
</code></pre></div></div> <p><img src="https://tvax2.sinaimg.cn/large/006VTcCxly1glwttpdbscj30rf2k7447.jpg" alt="图片"></p> <p>训练完XGBoost模型，绘制XGBoost模型训练好的特征重要性（ <strong>feature importance</strong> ）条形图，查看哪些特征对幸福度（happiness）特征重要。</p> <p>所有特征中，重要性最高的特征是province即采访地点：省/自治区/直辖市编码，也就是说明，生活在哪个城市对幸福程度是最重要的。这首先在于，由于快速的城市化进程，我国城市的数量和规模日益增加。在未来的20年中，中国将进一步加速城市化进程。这在最直观的角度说明了“城市”这一特殊的经济体（区域）的重要性。其次，在城市经济学理论中，城市既是各种活动的聚集地，更是有着一定内聚力（聚集经济、规模经济）的经济形态。城市的各种条件、活动无疑将对人们的幸福起到更举足轻重的作用。</p> <p>其次，equity特征即填写问卷对象认为当今社会公不公平的程度，也对幸福度有着很大的重要性。国家治理质量的提高对人们的幸福感则具有决定性的意义。幸福感在很大程度上取决于横向的比较，所以不公平会成为人们不幸福的根本原因。这也印证了《论语》里的老话，“不患寡而患不均”。 class_10_after即调查对象认为他们10年后将会在哪个等级上，也就是对未来的定位和奋斗目标，对当前的幸福感也占了很大的比重。每个人每天生活的是否幸福也取决于人们每天与街坊邻居相处的是否融洽，所以neighbor_familiarity也占着很大的比重。</p> <p>从直观来说，排除去主要的影响幸福感的因素之后，每个人的幸福感也可能源自于自己的身心健康和外貌，所以depression即感到心情抑郁或沮丧的频繁程度和health即身体健康状况也占有很大的重要性。</p> <p>幸福度重要性中最少的是invest和property特征，即一个人的投资和房产的信息，也侧面说明了并不是富裕的人才会幸福贫穷的人不会感到幸福。</p> <p>这也进一步说明了所有靠物质支撑的幸福感，都不能持久，都会随着物质的离去而离去。只有心灵的淡定宁静，继而产生的身心愉悦，才是幸福的真正源泉。</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predict</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">happiness</span><span class="sh">'</span> <span class="p">:</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">test</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="sh">'</span><span class="s">survey_time</span><span class="sh">'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))},</span> <span class="n">index</span><span class="o">=</span><span class="n">test</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">submit</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predict</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="sh">'</span><span class="s">happiness</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict</span><span class="p">[</span><span class="sh">'</span><span class="s">happiness</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">submit</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">./data/predict.csv</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/LaTeX%E4%B8%8D%E5%A4%AA%E7%AE%80%E7%9F%AD%E7%9A%84%E4%BB%8B%E7%BB%8D/">LaTeX 不太简短的介绍</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Ubuntu-22.04-%E5%AE%89%E8%A3%85-MySQL/">Ubuntu 22.04 安装 MySQL</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Clean-Architecture/">Clean Architecture</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Ubuntu-22.04-MacOS-Monterey-%E4%B8%BB%E9%A2%98/">LaTeX Workshop 配置信息</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/CASIA-WebMaskedFace-%E6%A8%A1%E6%8B%9F%E4%BD%A9%E6%88%B4%E5%8F%A3%E7%BD%A9%E4%BA%BA%E8%84%B8%E6%95%B0%E6%8D%AE%E9%9B%86/">CASIA-WebMaskedFace 模拟佩戴口罩人脸数据集</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Geek F. x. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>